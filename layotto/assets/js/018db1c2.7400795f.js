"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[2894],{786:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var o=t(4848),s=t(8453);const r={},a="\u81ea\u52a8\u751f\u6210 API \u63d2\u4ef6",i={id:"start/api_plugin/generate",title:"\u81ea\u52a8\u751f\u6210 API \u63d2\u4ef6",description:"Writing the API plugin yourself is boring. You can use Layotto's code generator to generate all the code.",source:"@site/docs/start/api_plugin/generate.md",sourceDirName:"start/api_plugin",slug:"/start/api_plugin/generate",permalink:"/layotto/docs/start/api_plugin/generate",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/docs/docs/start/api_plugin/generate.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"API \u63d2\u4ef6: \u6ce8\u518c\u60a8\u81ea\u5df1\u7684API",permalink:"/layotto/docs/start/api_plugin/helloworld"},next:{title:"\u96c6\u6210 Istio 1.10.6 \u6f14\u793a",permalink:"/layotto/docs/start/istio/"}},c={},l=[{value:"Reference",id:"reference",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"\u81ea\u52a8\u751f\u6210-api-\u63d2\u4ef6",children:"\u81ea\u52a8\u751f\u6210 API \u63d2\u4ef6"}),"\n",(0,o.jsx)(n.p,{children:"Writing the API plugin yourself is boring. You can use Layotto's code generator to generate all the code."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"[!TIP|label: Types of API plugins]\nThere are two types of API plugins:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"In-tree plugins."}),"\n",(0,o.jsx)(n.li,{children:"Out-of-tree plugins"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The code of in-tree plugins is located in the layotto repo, while the code of out-of-tree plugins can be placed in your own repo outside the layotto repo."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"This guide will show you how to generate out-of-tree plugins"}),". If you want to generate in-tree plugins, see ",(0,o.jsx)(n.a,{href:"/docs/api_reference/how_to_generate_api_doc",children:"the other doc"})," for help."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Let's say you want to add a ",(0,o.jsx)(n.code,{children:"PublishTransactionalMessage"})," method to the existing pubsub API. You write a new proto file ",(0,o.jsx)(n.code,{children:"cmd/layotto_multiple_api/advanced_queue/advanced_queue.proto"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:"// ......\n/* @exclude extends pub_subs */\n// AdvancedQueue is advanced pubsub API\nservice AdvancedQueue {\n\n  rpc PublishTransactionalMessage(TransactionalMessageRequest) returns (TransactionalMessageResponse);\n\n}\n\nmessage TransactionalMessageRequest {\n  string store_name = 1;\n\n  string content = 2;\n}\n\nmessage TransactionalMessageResponse {\n  string message_id = 1;\n}\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"and run the generator:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:"protoc -I . \\\n          --go_out . --go_opt=paths=source_relative \\\n          --go-grpc_out=. \\\n          --go-grpc_opt=require_unimplemented_servers=false,paths=source_relative \\\n          --p6_out ./cmd/layotto_multiple_api/advanced_queue --p6_opt=paths=source_relative \\\n          cmd/layotto_multiple_api/advanced_queue/advanced_queue.proto\n"})}),"\n",(0,o.jsx)(n.p,{children:"then you get the code:"}),"\n",(0,o.jsx)("img",{src:"https://user-images.githubusercontent.com/26001097/189822603-c4c9d0c6-86a1-4a66-bba8-3d01758808e7.png",width:"30%",height:"30%"}),"\n",(0,o.jsxs)(n.p,{children:["Fix the path error and then you can register this API plugin in your ",(0,o.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"/docs/api_reference/how_to_generate_api_doc",children:"How to generate code and documentation from the .proto files"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://github.com/layotto/protoc-gen-p6",children:"protoc-gen-p6"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var o=t(6540);const s={},r=o.createContext(s);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);
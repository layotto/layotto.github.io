"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[2124],{6967:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>r});var l=i(4848),o=i(8453);const a={},s="\u4f7f\u7528ctripcorp/apollo\u5b9e\u73b0Configuration API",t={id:"design/configuration/configuration-api-with-apollo",title:"\u4f7f\u7528ctripcorp/apollo\u5b9e\u73b0Configuration API",description:"\u76ee\u6807",source:"@site/docs/design/configuration/configuration-api-with-apollo.md",sourceDirName:"design/configuration",slug:"/design/configuration/configuration-api-with-apollo",permalink:"/layotto/docs/design/configuration/configuration-api-with-apollo",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/design/configuration/configuration-api-with-apollo.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"MOSN gRPC \u6846\u67b6\u8bbe\u8ba1\u6587\u6863",permalink:"/layotto/docs/design/actuator/grpc-design-doc"},next:{title:"Layotto Pub/Sub\u3001\u517c\u5bb9Dapr\u5305\u65b9\u6848",permalink:"/layotto/docs/design/pubsub/pubsub-api-and-compability-with-dapr-component"}},c={},r=[{value:"\u76ee\u6807",id:"\u76ee\u6807",level:2},{value:"Schema",id:"schema",level:2},{value:"Configuration API\u6620\u5c04apollo schema",id:"configuration-api\u6620\u5c04apollo-schema",level:3},{value:"\u5982\u4f55\u8fc1\u79fb\u5386\u53f2\u9057\u7559\u9879\u76ee",id:"\u5982\u4f55\u8fc1\u79fb\u5386\u53f2\u9057\u7559\u9879\u76ee",level:3},{value:"sidecar\u7684config.json\u6587\u4ef6",id:"sidecar\u7684configjson\u6587\u4ef6",level:3},{value:"API",id:"api",level:2},{value:"\u6211\u8be5\u4f7f\u7528\u54ea\u4e2aApollo SDK\uff1f",id:"\u6211\u8be5\u4f7f\u7528\u54ea\u4e2aapollo-sdk",level:3},{value:"\u6211\u5e94\u8be5\u5982\u4f55\u4f7f\u7528Apollo SDK API",id:"\u6211\u5e94\u8be5\u5982\u4f55\u4f7f\u7528apollo-sdk-api",level:3},{value:"\u5982\u4f55\u8ba2\u9605\u6307\u5b9a\u5e94\u7528\u7684\u6240\u6709\u914d\u7f6e\u53d8\u66f4",id:"\u5982\u4f55\u8ba2\u9605\u6307\u5b9a\u5e94\u7528\u7684\u6240\u6709\u914d\u7f6e\u53d8\u66f4",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"\u4f7f\u7528ctripcorpapollo\u5b9e\u73b0configuration-api",children:"\u4f7f\u7528ctripcorp/apollo\u5b9e\u73b0Configuration API"}),"\n",(0,l.jsx)(n.h2,{id:"\u76ee\u6807",children:"\u76ee\u6807"}),"\n",(0,l.jsxs)(n.p,{children:["\u4f7f\u7528ctripcorp/apollo\u5b9e\u73b0",(0,l.jsx)(n.a,{href:"https://github.com/dapr/dapr/issues/2988",children:"Configuration API(level-2)"})]}),"\n",(0,l.jsx)(n.h2,{id:"schema",children:"Schema"}),"\n",(0,l.jsx)(n.h3,{id:"configuration-api\u6620\u5c04apollo-schema",children:"Configuration API\u6620\u5c04apollo schema"}),"\n",(0,l.jsx)(n.p,{children:"\u6620\u5c04\u89c4\u5219\u5982\u4e0b:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Configuration API\u53c2\u6570"}),(0,l.jsx)(n.th,{children:"apollo schema"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"app_id"}),(0,l.jsx)(n.td,{children:"//\u5f53\u67e5\u8be2\u6216\u8005\u8ba2\u9605\u65f6\u5ffd\u7565\u8be5\u53c2\u6570\uff0c\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684app_id\u66ff\u4ee3"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"group"}),(0,l.jsx)(n.td,{children:"namespace"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"label"}),(0,l.jsx)(n.td,{children:"//\u8ffd\u52a0\u5230key\u7684\u540e\u9762. \u5728apollo\u4e2dkey\u5b9e\u9645\u5b58\u50a8\u7684\u683c\u5f0f\u4e3a'key@$label'"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"tag"}),(0,l.jsx)(n.td,{children:"//\u4ee5json\u683c\u5f0f\u7f6e\u4e8e\u914d\u7f6e\u4e2d\u7684\u67d0\u4e00\u9879"})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:["\u5728apollo\u4e2dkey\u5b9e\u9645\u5b58\u50a8\u7684\u683c\u5f0f\u4e3a",(0,l.jsx)(n.code,{children:"key@$label"}),"\uff0cvalue\u4e3a\u539f\u59cb\u503c\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["Tags\u5c06\u4ee5key=",(0,l.jsx)(n.code,{children:"group@$key@$label"})," and value="]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "tag1": "tag1value",\n  "tag2": "tag2value"\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u7684\u683c\u5f0f\u5b58\u50a8\u5728\u7279\u5b9a\u7684namespace ",(0,l.jsx)(n.code,{children:"sidecar_config_tags"}),"\u4e2d"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Q: \u4e3a\u4ec0\u4e48\u4e0d\u7528\u4e00\u4e2aitem\u5b58\u50a8value\u548ctags\u4ee5\u51cf\u5c0f\u67e5\u8be2\u7684\u6b21\u6570\uff0c\u4f8b\u5982:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n    "value":"raw value",\n    "tags":{\n        "tag1":"tag1value",\n        "tag2":"tag2value"\n    }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"A: \u5982\u679c\u91c7\u7528\u8fd9\u79cd\u8bbe\u8ba1\u65b9\u6848\uff0c\u90a3\u4e48\u539f\u6765\u4f7f\u7528apollo\u7684\u5386\u53f2\u9057\u7559\u9879\u76ee\u5c06\u4e0d\u80fd\u591f\u8fc1\u79fb\u5230sidecar\u4e2d"}),"\n",(0,l.jsx)(n.h3,{id:"\u5982\u4f55\u8fc1\u79fb\u5386\u53f2\u9057\u7559\u9879\u76ee",children:"\u5982\u4f55\u8fc1\u79fb\u5386\u53f2\u9057\u7559\u9879\u76ee"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Get/subscribe API\u662f\u517c\u5bb9\u7684\u3002\u5982\u679c\u6ca1\u6709\u4f7f\u7528save/delete\u7684API\uff0c\u90a3\u4e48\u7528\u6237\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5c06\u5386\u53f2\u9057\u7559\u9879\u76ee\u5c06\u8fc1\u79fb\u5230sidecar\u5f53\u4e2d\u3002\u53ea\u9700\u8981\u5728config.json\u6587\u4ef6\u4e2d\u4fdd\u6301",(0,l.jsx)(n.code,{children:"label"}),"\u5b57\u6bb5\u4e3a\u7a7a\uff0csidecar\u5c06\u4f1a\u4f7f\u7528\u539f\u59cbkey\u6765\u66ff\u4ee3",(0,l.jsx)(n.code,{children:"key@$label"}),"\u4e0eapollo\u8fdb\u884c\u4ea4\u4e92\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["Save/delete API\u53ef\u80fd\u4e0d\u517c\u5bb9\u3002sidecar\u4f1a\u5728config.json\u4f7f\u7528\u56fa\u5b9a\u7684",(0,l.jsx)(n.code,{children:"cluster"}),"\u548c",(0,l.jsx)(n.code,{children:"env"}),"\u5b57\u6bb5\u3002\u8fd9\u610f\u5473\u7740\u7528\u6237\u5982\u679c\u60f3\u8981\u7528\u5176\u4ed6\u7684appid\u6765\u53d8\u66f4\u4e00\u4e9b\u914d\u7f6e\u9879\uff0c\u5c06\u65e0\u6cd5\u901a\u8fc7",(0,l.jsx)(n.code,{children:"cluster"}),"\u548c",(0,l.jsx)(n.code,{children:"env"}),"\u5b57\u6bb5\u4f5c\u4e3asave/deleteAPI\u7684\u53c2\u6570\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sidecar\u7684configjson\u6587\u4ef6",children:"sidecar\u7684config.json\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "config_store": {\n    "type": "apollo",\n    "address": [\n      "http://106.54.227.205:8080"\n    ],\n    "metadata": {\n      "app_id": "testApplication_yang",\n      "cluster": "dev",\n      "namespace_name": "dubbo,product.joe",\n      "is_backup_config": true,\n      "secret": "6ce3ff7e96a24335a9634fe9abca6d51"\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,l.jsx)(n.h3,{id:"\u6211\u8be5\u4f7f\u7528\u54ea\u4e2aapollo-sdk",children:"\u6211\u8be5\u4f7f\u7528\u54ea\u4e2aApollo SDK\uff1f"}),"\n",(0,l.jsxs)(n.p,{children:["\u76ee\u524d\u91c7\u7528\u5b98\u65b9\u7ef4\u62a4\u7684",(0,l.jsx)(n.a,{href:"https://github.com/apolloconfig/agollo",children:"SDK"}),"\uff0c\u5176\u5b83Apollo\u7b2c\u4e09\u65b9\u7684SDK\u53ef\u4ee5\u4ece",(0,l.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/usage/third-party-sdks-user-guide",children:"\u94fe\u63a5"}),"\u627e\u5230\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u8be5sdk\u7684\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5728\u8fde\u63a5server\u548c\u521b\u5efaclient\u4e4b\u524d\uff0c\u7528\u6237\u5fc5\u987b\u5148\u5728AppConfig\u58f0\u660e\u6240\u6709\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u4f8b\u5b50\u5982\u4e0b\u6240\u793a\uff1a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'\tc := &config.AppConfig{\n\t\tAppID:          "testApplication_yang",\n\t\tCluster:        "dev",\n\t\tIP:             "http://106.54.227.205:8080",\n\t\tNamespaceName:  "dubbo",  // \u5728\u8fde\u63a5server\u4e4b\u524d\u58f0\u660e\n\t\tIsBackupConfig: true,\n\t\tSecret:         "6ce3ff7e96a24335a9634fe9abca6d51",\n\t}\n\tclient, err := agolloConfig.StartWithConfig(func() (*config.AppConfig, error) {\n\t\treturn c, nil\n\t})\n'})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u914d\u7f6e\u4e0d\u4e86",(0,l.jsx)(n.code,{children:"env"}),"\u5b57\u6bb5\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u65e0Save/delete API\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u65e0\u6279\u91cf\u67e5\u8be2API\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u4e0d\u80fd\u786e\u4fdd\u5e76\u53d1\u5b89\u5168\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["\u914d\u7f6e\u6216\u8005\u4f7f\u7528\u4e0d\u4e86",(0,l.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/usage/java-sdk-user-guide?id=_122-apollo-meta-server",children:"Apollo Meta Server"}),"\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u8bbe\u7f6ekv\u548ctags\u64cd\u4f5c\u4e0d\u662f\u4e8b\u52a1\uff0c\u5b58\u5728\u4e00\u81f4\u6027\u95ee\u9898\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u6211\u5e94\u8be5\u5982\u4f55\u4f7f\u7528apollo-sdk-api",children:"\u6211\u5e94\u8be5\u5982\u4f55\u4f7f\u7528Apollo SDK API"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Configuration API"}),(0,l.jsx)(n.th,{children:"apollo sdk API"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"GetConfiguration"}),(0,l.jsx)(n.td,{children:'cache := client.GetConfigCache(c.NamespaceName)   value,_ := client.Get("key")'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SaveConfiguration"}),(0,l.jsxs)(n.td,{children:["\u901a\u8fc7http. ",(0,l.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/usage/apollo-open-api-platform?id=_3211-%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae%e6%8e%a5%e5%8f%a3",children:"update"})," + ",(0,l.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/usage/apollo-open-api-platform?id=_3213-%e5%8f%91%e5%b8%83%e9%85%8d%e7%bd%ae%e6%8e%a5%e5%8f%a3",children:"commit"})," \u4f7f\u7528open API"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"DeleteConfiguration"}),(0,l.jsxs)(n.td,{children:["\u4f7f\u7528http. ",(0,l.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/usage/apollo-open-api-platform?id=_3212-%e5%88%a0%e9%99%a4%e9%85%8d%e7%bd%ae%e6%8e%a5%e5%8f%a3",children:"delete"})," + ",(0,l.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/usage/apollo-open-api-platform?id=_3213-%e5%8f%91%e5%b8%83%e9%85%8d%e7%bd%ae%e6%8e%a5%e5%8f%a3",children:"commit"})," \u4f7f\u7528open API"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SubscribeConfiguration"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.a,{href:"https://github.com/apolloconfig/agollo/wiki/%E7%9B%91%E5%90%AC%E5%8F%98%E6%9B%B4%E4%BA%8B%E4%BB%B6",children:"https://github.com/apolloconfig/agollo/wiki/%E7%9B%91%E5%90%AC%E5%8F%98%E6%9B%B4%E4%BA%8B%E4%BB%B6"})})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"\u5982\u4f55\u8ba2\u9605\u6307\u5b9a\u5e94\u7528\u7684\u6240\u6709\u914d\u7f6e\u53d8\u66f4",children:"\u5982\u4f55\u8ba2\u9605\u6307\u5b9a\u5e94\u7528\u7684\u6240\u6709\u914d\u7f6e\u53d8\u66f4"}),"\n",(0,l.jsx)(n.p,{children:"\u8ba2\u9605config.json\u6587\u4ef6\u4e2d\u6240\u6709\u58f0\u660e\u7684namespaces\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>t});var l=i(6540);const o={},a=l.createContext(o);function s(e){const n=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);
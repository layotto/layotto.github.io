"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[3185],{8405:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var i=t(4848),s=t(8453);const o={},r="FaaS QuickStart",a={id:"start/faas/start",title:"FaaS QuickStart",description:"1. Features",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/start/faas/start.md",sourceDirName:"start/faas",slug:"/start/faas/start",permalink:"/layotto/en-US/docs/start/faas/start",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/start/faas/start.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Run business logic in Layotto using WASM",permalink:"/layotto/en-US/docs/start/wasm/start"},next:{title:"\u7ebf\u4e0a\u5b9e\u9a8c\u5ba4",permalink:"/layotto/en-US/docs/start/lab"}},l={},d=[{value:"1. Features",id:"1-features",level:2},{value:"2. Dependent software",id:"2-dependent-software",level:3},{value:"3. Setup",id:"3-setup",level:3},{value:"A\u3001Install &amp; run Redis",id:"ainstall--run-redis",level:4},{value:"B\u3001Start minikube in virtualbox + containerd mode",id:"bstart-minikube-in-virtualbox--containerd-mode",level:4},{value:"C\u3001Compile &amp; install Layotto",id:"ccompile--install-layotto",level:4},{value:"D\u3001Compile &amp; install containerd-shim-layotto-v2",id:"dcompile--install-containerd-shim-layotto-v2",level:4},{value:"E\u3001Modify &amp; restart containerd",id:"emodify--restart-containerd",level:4},{value:"F\u3001Install wasmer (If the vm engine uses wasmer, you need to execute the following command)",id:"finstall-wasmer-if-the-vm-engine-uses-wasmer-you-need-to-execute-the-following-command",level:4},{value:"4. Quickstart",id:"4-quickstart",level:3},{value:"A\u3001Start Layotto",id:"astart-layotto",level:4},{value:"B\u3001Create Layotto runtime",id:"bcreate-layotto-runtime",level:4},{value:"C\u3001Create Function",id:"ccreate-function",level:4},{value:"D\u3001Write inventory to Redis",id:"dwrite-inventory-to-redis",level:4},{value:"E\u3001Send request",id:"esend-request",level:4},{value:"5. Process introduction",id:"5-process-introduction",level:3},{value:"Common problem description",id:"common-problem-description",level:3},{value:"6. Note",id:"6-note",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"faas-quickstart",children:"FaaS QuickStart"}),"\n",(0,i.jsx)(n.h2,{id:"1-features",children:"1. Features"}),"\n",(0,i.jsx)(n.p,{children:"Layotto supports loading and running functions in the form of wasm, and supports calling each other between functions and accessing infrastructure, such as Redis."}),"\n",(0,i.jsxs)(n.p,{children:["Detailed design documents can refer to\uff1a",(0,i.jsx)(n.a,{href:"/layotto/en-US/docs/design/faas/faas-poc-design",children:"FaaS design"})]}),"\n",(0,i.jsx)(n.h3,{id:"2-dependent-software",children:"2. Dependent software"}),"\n",(0,i.jsx)(n.p,{children:"The following software needs to be installed to run this demo:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.docker.com/products/docker-desktop",children:"Docker Desktop"})}),"\n",(0,i.jsx)(n.p,{children:"Download the installation package from the official website and install it."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://minikube.sigs.k8s.io/docs/start/",children:"minikube"})}),"\n",(0,i.jsx)(n.p,{children:"Follow the instructions on the official website."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.oracle.com/virtualization/technologies/vm/virtualbox.html",children:"virtualbox"})}),"\n",(0,i.jsxs)(n.p,{children:["Download the installation package from the official website and install it. You can also use ",(0,i.jsx)(n.a,{href:"https://brew.sh/",children:"homebrew"})," to install it on mac. If the startup fails after installation, please refer to ",(0,i.jsx)(n.a,{href:"https://github.com/kubernetes/minikube/issues/3614",children:"The host-only adapter we just created is not visible"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-setup",children:"3. Setup"}),"\n",(0,i.jsx)(n.h4,{id:"ainstall--run-redis",children:"A\u3001Install & run Redis"}),"\n",(0,i.jsx)(n.p,{children:"The example only needs a Redis server that can be used normally. As for where it is installed, there is no special restriction. It can be a virtual machine, a local machine or a server. Here, the installation on mac is used as an example to introduce."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> brew install redis\n> redis-server /usr/local/etc/redis.conf\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.em,{children:"Note: If you want external services to connect to redis, you need to modify the protected-mode in redis.conf to no,At the same time, add bind * -::"})," to let it monitor all interfaces."]}),"*"]}),"\n",(0,i.jsx)(n.h4,{id:"bstart-minikube-in-virtualbox--containerd-mode",children:"B\u3001Start minikube in virtualbox + containerd mode"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> minikube start --driver=virtualbox --container-runtime=containerd\n"})}),"\n",(0,i.jsx)(n.h4,{id:"ccompile--install-layotto",children:"C\u3001Compile & install Layotto"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> git clone https://github.com/mosn/layotto.git\n> cd layotto\n> make wasm-build\n> minikube cp ./_output/linux/amd64/layotto /home/docker/layotto\n> minikube cp ./demo/faas/config.json /home/docker/config.json\n> minikube ssh\n> sudo chmod +x layotto\n> sudo mv layotto /usr/bin/\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note1: You need to modify the redis address as needed, the default address is: localhost:6379"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Note2: Need to modify the path of the wasm file in ",(0,i.jsx)(n.code,{children:"./demo/faas/config.json"})," to ",(0,i.jsx)(n.code,{children:"/home/docker/function_1.wasm"})," and ",(0,i.jsx)(n.code,{children:"/home/docker/function_2.wasm"})]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Note3: We can also load WASM file dynamically. For details, see ",(0,i.jsx)(n.a,{href:"https://mosn.io/layotto/#/en/start/wasm/start?id=dynamic-load",children:"WASM Dynamic Load"})]})}),"\n",(0,i.jsx)(n.h4,{id:"dcompile--install-containerd-shim-layotto-v2",children:"D\u3001Compile & install containerd-shim-layotto-v2"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> git clone https://github.com/layotto/containerd-wasm.git\n> cd containerd-wasm\n> sh build.sh\n> minikube cp containerd-shim-layotto-v2 /home/docker/containerd-shim-layotto-v2\n> minikube ssh\n> sudo chmod +x containerd-shim-layotto-v2\n> sudo mv containerd-shim-layotto-v2 /usr/bin/\n"})}),"\n",(0,i.jsx)(n.h4,{id:"emodify--restart-containerd",children:"E\u3001Modify & restart containerd"}),"\n",(0,i.jsx)(n.p,{children:"Add laytto runtime configuration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'> minikube ssh\n> sudo vi /etc/containerd/config.toml\n[plugins.cri.containerd.runtimes.layotto]\n  runtime_type = "io.containerd.layotto.v2"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Restart containerd for the latest configuration to take effect"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo systemctl restart containerd\n"})}),"\n",(0,i.jsx)(n.h4,{id:"finstall-wasmer-if-the-vm-engine-uses-wasmer-you-need-to-execute-the-following-command",children:"F\u3001Install wasmer (If the vm engine uses wasmer, you need to execute the following command)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> curl -L -O https://github.com/wasmerio/wasmer/releases/download/2.0.0/wasmer-linux-amd64.tar.gz\n> tar zxvf wasmer-linux-amd64.tar.gz\n> sudo cp lib/libwasmer.so /usr/lib/libwasmer.so\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-quickstart",children:"4. Quickstart"}),"\n",(0,i.jsx)(n.h4,{id:"astart-layotto",children:"A\u3001Start Layotto"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> minikube ssh\n> layotto start -c /home/docker/config.json\n"})}),"\n",(0,i.jsx)(n.h4,{id:"bcreate-layotto-runtime",children:"B\u3001Create Layotto runtime"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> kubectl apply -f ./demo/faas/layotto-runtimeclass.yaml\nruntimeclass.node.k8s.io/layotto created\n"})}),"\n",(0,i.jsx)(n.h4,{id:"ccreate-function",children:"C\u3001Create Function"}),"\n",(0,i.jsx)(n.p,{children:"This operation will automatically inject function_1.wasm and function_2.wasm into the Virtualbox virtual machine."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> kubectl apply -f ./demo/faas/function-1.yaml\npod/function-1 created\n\n> kubectl apply -f ./demo/faas/function-2.yaml\npod/function-2 created\n"})}),"\n",(0,i.jsx)(n.h4,{id:"dwrite-inventory-to-redis",children:"D\u3001Write inventory to Redis"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> redis-cli\n127.0.0.1:6379> set book1 100\nOK\n"})}),"\n",(0,i.jsx)(n.h4,{id:"esend-request",children:"E\u3001Send request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"> minikube ip\n192.168.99.117\n\n> curl -H 'id:id_1' '192.168.99.117:2045?name=book1'\nThere are 100 inventories for book1.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-process-introduction",children:"5. Process introduction"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img.png",src:t(2602).A+"",width:"1285",height:"376"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"send http request to func1"}),"\n",(0,i.jsx)(n.li,{children:"func1 calls func2 through Runtime ABI"}),"\n",(0,i.jsx)(n.li,{children:"func2 calls redis through Runtime ABI"}),"\n",(0,i.jsx)(n.li,{children:"Return results"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"common-problem-description",children:"Common problem description"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:'Virtualbox failed to start, "The host-only adapter we just created is not visible":'}),"\n",(0,i.jsxs)(n.p,{children:["refer  ",(0,i.jsx)(n.a,{href:"https://github.com/kubernetes/minikube/issues/3614",children:"The host-only adapter we just created is not visible"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:'When Layotto is started, the redis connection fails, and "occurs an error: redis store: error connecting to redis at" is printed:'}),"\n",(0,i.jsx)(n.p,{children:"Check the redis configuration to see if it is caused by a redis configuration error."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"6-note",children:"6. Note"}),"\n",(0,i.jsx)(n.p,{children:"The FaaS model is currently in the POC stage, and the features are not complete. It will be improved in the following aspects in the future:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Limit the maximum resources that can be used when the function is running, such as cpu, heap, stack, etc."}),"\n",(0,i.jsx)(n.li,{children:"The functions loaded and run by different Layotto can call each other."}),"\n",(0,i.jsx)(n.li,{children:"Fully integrate into the k8s ecology, such as reporting the use of resources to k8s, so that k8s can perform better scheduling."}),"\n",(0,i.jsx)(n.li,{children:"Add more Runtime ABI."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If you are interested in FaaS or have any questions or ideas, please leave a message in the issue area, we can build FaaS together!"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},2602:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/faas-request-process-c45bdaf7aa4c5296908420585b075321.jpg"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);
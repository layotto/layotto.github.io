"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[5064],{5370:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var o=t(4848),i=t(8453);const s={},r="API Plugin Design Documentation & Use Guide",l={id:"design/api_plugin/design",title:"API Plugin Design Documentation & Use Guide",description:"The first half of this paper discusses what the API plugin solves and why it is designed, and the second half describes how the API plugin works.",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/design/api_plugin/design.md",sourceDirName:"design/api_plugin",slug:"/design/api_plugin/design",permalink:"/en-US/docs/design/api_plugin/design",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/design/api_plugin/design.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"reference",permalink:"/en-US/docs/building_blocks/configuration/reference"},next:{title:"Pluggable Component Use Documents",permalink:"/en-US/docs/design/pluggable/usage"}},a={},c=[{value:"Needs analysis",id:"needs-analysis",level:2},{value:"What issues to address",id:"what-issues-to-address",level:3},{value:"User scenarios and needs",id:"user-scenarios-and-needs",level:3},{value:"High level design",id:"high-level-design",level:2},{value:"Hierarchical API",id:"hierarchical-api",level:3},{value:"Design objectives",id:"design-objectives",level:3},{value:"Functional design",id:"functional-design",level:3},{value:"Guide to use",id:"guide-to-use",level:3},{value:"step 0. Define your own proto file and compile a pb",id:"step-0-define-your-own-proto-file-and-compile-a-pb",level:4},{value:"step 1. Write implementation for the API just defined",id:"step-1-write-implementation-for-the-api-just-defined",level:4},{value:"Step 2. Implement <code>GrpcAPI</code> interface, manage the life cycle of API plugins",id:"step-2-implement-grpcapi-interface-manage-the-life-cycle-of-api-plugins",level:4},{value:"What is the interpretation of\uff1a<code>CustomComponent</code>?",id:"what-is-the-interpretation-ofcustomcomponent",level:5},{value:"How does\uff1aconfigure a custom component?",id:"how-doesconfigure-a-custom-component",level:5},{value:"View Example",id:"view-example",level:5},{value:"Explain\uff1athese callbacks, constructions?",id:"explainthese-callbacks-constructions",level:5},{value:"step 3. Sign up your own API into Layotto",id:"step-3-sign-up-your-own-api-into-layotto",level:4},{value:"Step 4. Compile Run Layotto",id:"step-4-compile-run-layotto",level:4}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"api-plugin-design-documentation--use-guide",children:"API Plugin Design Documentation & Use Guide"}),"\n",(0,o.jsx)(n.p,{children:"The first half of this paper discusses what the API plugin solves and why it is designed, and the second half describes how the API plugin works."}),"\n",(0,o.jsx)(n.p,{children:"If you use only API plugins, you can jump directly to [2.4.Use Guide](design/api_plugin/design?id=_24 - Use Guide)"}),"\n",(0,o.jsx)(n.h2,{id:"needs-analysis",children:"Needs analysis"}),"\n",(0,o.jsx)(n.h3,{id:"what-issues-to-address",children:"What issues to address"}),"\n",(0,o.jsx)(n.p,{children:"Resolve extension issues.The API, either Dapr or open source Layotto, is currently unable to fully meet production needs."}),"\n",(0,o.jsx)(n.p,{children:"Looking at the development history of POSIX API and system call in the operating system domain, we can learn a lot to predict the future of Runtime.We can say that the Runtime API is unlikely to fully meet user needs in the future.Split OS Realm, even if there is a POSIX API, some scenes need to bypass standard\nAPI, operate special hardware with special instructions."}),"\n",(0,o.jsx)(n.p,{children:"Dapr extension is resolved through the Binding API, but this unstructured API has many problems (e.g. destroying portability, not supporting stream etc.)"}),"\n",(0,o.jsx)(n.h3,{id:"user-scenarios-and-needs",children:"User scenarios and needs"}),"\n",(0,o.jsx)(n.p,{children:"For example, there are the following user scenes\uff1a"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Companies have their own customized API needs because they are non-common and unsuited to open source Layotto/Dapr, so a company\u2019s intermediate team wants to develop itself into sidecar.If a company's project import source Layotto or Dapr, there is no way to extend API development under the current architecture, only Fork\nto make an extension"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://user-images.githubusercontent.com/26001097/131614836-60d797c8-b80b-4018-ad43-c2b874d35660.png",alt:"image"})}),"\n",(0,o.jsx)(n.p,{children:"User needs\uff1a in this case"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"sdk sink;"}),"\n",(0,o.jsx)(n.li,{children:"Multilingualism;"}),"\n",(0,o.jsx)(n.li,{children:"Cloud deployment (just need intermediate teams themselves to develop components for cloud environments without community ready-made components)"}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["Companies have new API requirements that fit into open source projects and thus demand the community, but the community has had difficulty in reaching consensus and has been struggling for months (e.g. ",(0,o.jsx)(n.a,{href:"https://github.com/dapr/dapr/issues/2988",children:"https://github.com/dapr/dapr/issues/2988"}),"\n).In such cases, companies may have operational pressures, cannot afford to wait for so long and want to relocate themselves before they move to new functions in the community."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"User needs\uff1a in this case"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The user is autonomous about this feature and does not need to persuade the community (along with Chinese and English) to make this feature work for the world"}),"\n",(0,o.jsx)(n.li,{children:"Rapid expansion, service operations"}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Users want to add fields to the Dapr API, first add fields to their Fork version, meet online needs, and then raise PR to the community.The community refused to add the field, PR was closed.\u7528\u6237\u5f88\u5c34\u5c2c\uff1a\u8fd9\u5b57\u6bb5\u5df2\u7ecf\u5728\u7ebf\u4e0a\u4f7f\u7528\u4e86\uff0c\u600e\u4e48\u5904\u7406\uff1f"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"high-level-design",children:"High level design"}),"\n",(0,o.jsx)(n.h3,{id:"hierarchical-api",children:"Hierarchical API"}),"\n",(0,o.jsx)(n.p,{children:"Refer to the OS Realm API for this year, we can design the Runtime API into multi-layer\uff1a"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://gw.alipayobjects.com/mdn/rms_5891a1/afts/img/A*bWnHR7yhiF4AAAAAAAAAAAAAARQnAQ",alt:"img.png"})}),"\n",(0,o.jsx)(n.p,{children:"\uff1a for OS fields"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"POSIX API"}),"\n",(0,o.jsx)(n.li,{children:"Various Unix-like system of its own System Call (with portability, implementing the same interface with different hardware drivers)"}),"\n",(0,o.jsx)(n.li,{children:"Special features provided by special hardware (no portable)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Based on this idea, we can design API plugins to support users extending their own private APIs."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://user-images.githubusercontent.com/26001097/131614802-c6f6a556-4e8b-4fee-b899-275a80e00eb6.png",alt:"image"})}),"\n",(0,o.jsx)(n.h3,{id:"design-objectives",children:"Design objectives"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Let open source users with customized development needs use Layotto instead of Fork by importing Layotto"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Simple enough to develop api plugin"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Config file is the same json, new api plugin does not need to add new configuration file"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"functional-design",children:"Functional design"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://user-images.githubusercontent.com/26001097/131614952-ccfc7d11-d376-41b0-b16c-2f17bfd2c9fc.png",alt:"image"})}),"\n",(0,o.jsx)(n.p,{children:"Layotto add a number of new extensions."}),"\n",(0,o.jsxs)(n.p,{children:["When using Layotto, a company user can maintain a project, import Layotto himself.Various extensions and components are stored in your project.If you are familiar with Java, this is similar to [Eureka]for Java communities (",(0,o.jsx)(n.a,{href:"https://github.com/Netflix/eureka",children:"https://github.com/Netflix/eureka"}),"), you can\nimport Eureka and then expand."]}),"\n",(0,o.jsxs)(n.p,{children:["When users want to add an API, they can develop a package in their own project (including their proto,pb files, their own API implementation), then call Layotto extension points in ",(0,o.jsx)(n.code,{children:"main.go"})," and register their API in Layotto."]}),"\n",(0,o.jsx)(n.h3,{id:"guide-to-use",children:"Guide to use"}),"\n",(0,o.jsx)(n.p,{children:"How to add your own proto, add your own private API?"}),"\n",(0,o.jsxs)(n.p,{children:["An example is ",(0,o.jsx)(n.a,{href:"https://github.com/mosn/layotto/tree/main/cmd/layotto_multiple_api/helloworld",children:"the shellowold package provided in the project"})," which implements custom API, ``Sayhello`"]}),"\n",(0,o.jsx)(n.p,{children:"Use this as an example to explain the steps to write an API plugin:"}),"\n",(0,o.jsx)(n.h4,{id:"step-0-define-your-own-proto-file-and-compile-a-pb",children:"step 0. Define your own proto file and compile a pb"}),"\n",(0,o.jsxs)(n.p,{children:["For example, users would like to add their own ",(0,o.jsx)(n.code,{children:"Greeter"})," API, offering the ",(0,o.jsx)(n.code,{children:"Sayhello"})," method, write a proto:\n(this example is my paste from ",(0,o.jsx)(n.a,{href:"https://github.com/grpc/grpc-go/blob/master/examples/helloworld/helloworld/helloworld.proto",children:"grpc official exams"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:'syntax = "proto3";\n\noption go_package = "google.golang.org/grpc/exames/hellotorld/hellowld";\noption java_multiple_files = true;\noption java_package = "io. rpc.examples.hellowld";\noption java_outer_classname = "HelloWorldProto";\n\npackage helloord;\n\n// The greening service definition.\nService Greeter {}\n  // Sends a greening\n  rpc Sayhello (HelloRequest) returns (HelloReply) {}\n}\n\n// The request message containing the user\'s name.\nmessage HelloRequest {\n  string name = 1;\n}\n\n// The response message containing the greies\nmessage Hello Reply to the LO\n  string message = 1;\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Then compile it into the ",(0,o.jsx)(n.code,{children:".pb.go"})," file."]}),"\n",(0,o.jsxs)(n.p,{children:["[Bellowold example pack provided by the project] (",(0,o.jsx)(n.a,{href:"https://github.com/mosn/layotto/tree/main/cmd/layotto_multiple_api/helloworld",children:"https://github.com/mosn/layotto/tree/main/cmd/layotto_multiple_api/helloworld"}),") steal a lazy, direct import of grpc officially compiled .pb.go\nfile\uff1a"]}),"\n",(0,o.jsx)("img",{src:"https://gw.alipayobjects.com/mdn/rms_5891a1/afts/img/A*9VnARJimj90AAAAAAAAAAAAAARQnAQ",width:"40%",height:"40%",alt:"score",align:"center"}),"\n",(0,o.jsx)(n.h4,{id:"step-1-write-implementation-for-the-api-just-defined",children:"step 1. Write implementation for the API just defined"}),"\n",(0,o.jsxs)(n.p,{children:["The protoc compiler will help you compile the interface ",(0,o.jsx)(n.code,{children:"hellotorld.GreeterServer"}),", based on proto file, but the interface needs to be translated by itself."]}),"\n",(0,o.jsxs)(n.p,{children:["For example, the ",(0,o.jsx)(n.code,{children:"server"})," we wrote in the example implements ",(0,o.jsx)(n.code,{children:"helloworl.GreeterServer"})," interface, with ",(0,o.jsx)(n.code,{children:"Sayhello"})," method:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'//server is used to implement elllowld.GreeterServer.\ntype server struct LO\n\tappId strating\n\t// custom-components which implement the `HelloWorld` interface\n\tname2component map[string]component. World\n\t// LockStore components. They are not used in this demo, we put them here as a demo.\n\tname2LockStore map[string]block. ockStore\n\tpb.UnimplementedGreeterServer\n}\n\n// Sayhello implements hellowd. reeterServer.Sayhello\nfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) 6\n\tif _, ok := s.name2component[componentName]; !ok $6\n\t\treturn &pb. elloReply{Message: "We don\'t want to talk with you!"}, nil\n\t}\n\tmessage, err := s.name2component[componentName]. ayHello(in.GetName()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &pb.HelloReply{Message: message}, nil\n}\n'})}),"\n",(0,o.jsxs)(n.h4,{id:"step-2-implement-grpcapi-interface-manage-the-life-cycle-of-api-plugins",children:["Step 2. Implement ",(0,o.jsxs)(n.a,{href:"https://github.com/mosn/layotto/blob/main/pkg/grpc/grpc_api.go",children:[(0,o.jsx)(n.code,{children:"GrpcAPI"})," interface"]}),", manage the life cycle of API plugins"]}),"\n",(0,o.jsx)(n.p,{children:"Now that you have your own API implementation, you need to register it on Layotto next step."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Rememberly"}),"\uff1aHow to register the API on the original grpc server?"]}),"\n",(0,o.jsx)(n.p,{children:"Just write this line of code\uff1a"}),"\n",(0,o.jsxs)(n.p,{children:["pb.RegisterGreeterServer (s, &server",")"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"To register your API on Layotto,\uff1a"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Implementing ",(0,o.jsxs)(n.a,{href:"https://github.com/mosn/layotto/blob/main/pkg/grpc/grpc_api.go",children:[(0,o.jsx)(n.code,{children:"GrpcAPI"})," interface"]}),", implementing some lifecycle hooks"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This GrpcAPI manages your API lifecycle and provides various life cycle hooks.There are currently Init and Register in the current lifecycle hook."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// GrpcAPI is the interface of API plugin. It has lifecycle related methods\ntype GrpcAPI interface of the APIs\n    // init this API before binding it to the grpc server.\n    // For example, you can call the app to every their subscriptions.\n    Init (conn *grpc. lientConn) error\n    \n    // Bind this API to the grpc server\n    Register(s *grpc. erver, registeredServer mgrp.RegisteredServer) (mgrpc.RegisteredServer, error)\n}\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Performs the corresponding constructor ",(0,o.jsx)(n.code,{children:"NewGrpcAPI"})," to create your ",(0,o.jsx)(n.code,{children:"GrpcAPI"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// NewGrpcAPI is the constructor of GpcAPI\ntype NewGrpcAPI func (applicationContext *ApplicationContext) GrpcAPI\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"*ApplicationContext"})," is defined as\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// ApplicationContext contains all you need to construct your GrpcAPI, such as all the components.\n// For example, your `SuperState` GrpcAPI can hold the `StateStores` components and use them to implement your own `Super State API` logic.\ntype ApplicationContext struct {\n    AppId                 string\n    Hellos                map[string]hello.HelloService\n    ConfigStores          map[string]configstores.Store\n    Rpcs                  map[string]rpc.Invoker\n    PubSubs               map[string]pubsub.PubSub\n    StateStores           map[string]state.Store\n    Files                 map[string]file.File\n    LockStores            map[string]lock.LockStore\n    Sequencers            map[string]sequencer.Store\n    SendToOutputBindingFn func(name string, req *bindings.InvokeRequest) (*bindings.InvokeResponse, error)\n    SecretStores          map[string]secretstores.SecretStore\n    CustomComponent       map[string]map[string]custom.Component\n}\n"})}),"\n",(0,o.jsxs)(n.h5,{id:"what-is-the-interpretation-ofcustomcomponent",children:["What is the interpretation of\uff1a",(0,o.jsx)(n.code,{children:"CustomComponent"}),"?"]}),"\n",(0,o.jsx)(n.p,{children:'is "Custom components".'}),"\n",(0,o.jsx)(n.p,{children:"Component in Layotto is divided into prime mill\uff1a"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Preset Component"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["e.g. ",(0,o.jsx)(n.code,{children:"pubsub"})," components, like ",(0,o.jsx)(n.code,{children:"state"})," component"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Custom Component"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Allows you to expand your own components, such as the ",(0,o.jsx)(n.code,{children:"HelloWorld"})," component in the example below."]}),"\n",(0,o.jsx)(n.h5,{id:"how-doesconfigure-a-custom-component",children:"How does\uff1aconfigure a custom component?"}),"\n",(0,o.jsxs)(n.p,{children:["See",(0,o.jsx)(n.a,{href:"/en-US/docs/component_specs/custom/common",children:"\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u7684\u914d\u7f6e\u6587\u6863"})]}),"\n",(0,o.jsx)(n.h5,{id:"view-example",children:"View Example"}),"\n",(0,o.jsxs)(n.p,{children:["Look at a specific example, in ",(0,o.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/main/cmd/layotto_multiple_api/helloworld/grpc_api.go",children:"helloowold exams"}),", ",(0,o.jsx)(n.code,{children:"*server"})," implements ",(0,o.jsx)(n.code,{children:"Init"}),"\nand ",(0,o.jsx)(n.code,{children:"Register"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (s *server) Init (conn *rawGRPC.ClientConn) error {\n\treturn nil\n}\n\nfunc (s *server) Register(grpcServer *rawGRPC.Server, registeredServer mgrpc. egisteredServer) (mgrpc.RegisteredServer, error) um\n\tpb.RegisterGreeterServer (GrpcServer, s)\n\treturn registeredServer, nil\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"There is also a construction:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'func NewHelloWorldAPI(ac *grpc_api.ApplicationContext) grpc.GrpcAPI\n\t// 1. convert custom-components components\n\tname2component := make(map[string]component. elloWorld)\n\tif len(ac.CustomComponent) != 0 56\n\t\t/we only care about those components of type "helloowl"\n\t\tname2comp, ok := ac. customomComponent[kind]\n\t\tif ok & len (name2comp) > 0 F6\n\t\t\tfor name, ::= range name2comp LO\n\t\t\t\t// convert them using type assortion\n\t\t\t\tcomp, ok := v. component.HelloWorld)\n\t\t\t\tif !ok\n\t\t\t\t\terrMsg := fmt. printf("customom component %s does not implement HelloWorld interface", name)\n\t\t\t\t\tlog.DefaultLogger. rorf(errMsg)\n\t\t\t\t}\n\t\t\t\tname2component[name] = comp\n\t\t\t}\n\t\t}\n\t}\n\t/ 2. Construct your API implementation\n\treturn &server\n\t\tappId: ac. ppId,\n\t\t// Your API plugins in can store and use all the components.\n\t\t// For example, this demand set all the LockStore components here.\n\t\tname2LockStore: ac.LockStories,\n\t\t// Customers components of type "helloorl"\n\t\tname2component: name2component,\n\t}\n}\n'})}),"\n",(0,o.jsx)(n.h5,{id:"explainthese-callbacks-constructions",children:"Explain\uff1athese callbacks, constructions?"}),"\n",(0,o.jsx)(n.p,{children:"Look at this example, you might ask\uff1athese callbacks, constructions and calls?"}),"\n",(0,o.jsx)(n.p,{children:"The hook above is used to customize the start logic for the user extension.Layotto reverses the above life-cycle hooks and constructions during startup.Call order roughly\uff1a"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Layotto initialize all components"})," ---\x3e Call ",(0,o.jsx)(n.code,{children:"NewGrpcAPI"})," constructor ---\x3e ",(0,o.jsx)(n.code,{children:"GrpcAPI.Init"})," ---\x3e ",(0,o.jsx)(n.code,{children:"Layotto create grpc server` ---\x3e"}),"GrpcAPI.Register``"]}),"\n",(0,o.jsx)(n.p,{children:"Graph below\uff1a"}),"\n",(0,o.jsx)("img",{src:"https://gw.alipayobjects.com/mdn/rms_5891a1/afts/img/A*7_NyQL-FjigAAAAAAAAAAAAAARQnAQ",width:"40%",height:"40%",alt:"score",align:"center"}),"\n",(0,o.jsx)(n.h4,{id:"step-3-sign-up-your-own-api-into-layotto",children:"step 3. Sign up your own API into Layotto"}),"\n",(0,o.jsxs)(n.p,{children:["After achieving your private API\nfollowing the above steps, you can ",(0,o.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/5234a80cdc97798162d03546eb8e0ee163c0ad60/cmd/layotto_multiple_api/main.go#L203",children:"register it in your main main in Layotto"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'\nfunc NewRuntimeGrpcServer (data json.RawMessage, options..grpc.ServerOption) (mgrpc. egisteredServer, error) LO\n\t// ......\n\t\n    /3. run\n    server, err := rt. un(\n        runtime.WithGrpcOptions(opts... ,\n        // register your GrpcAPI here\n        runtime. ithGrpcAPI(\n            // default GrpcAPI\n            default_api. ewGrpcAPI,\n            // a demo to show how to register your own GrpcAPI\n            helloord_api. ewHelloWorldAPI,\n        ),\n        // Hello\n        runtime. ithHelloFactory (\n            hello.NewHelloFactory ("hellotorld", hellold. ewHelloWorld),\n        ),\n    // ...\n'})}),"\n",(0,o.jsx)(n.p,{children:"We recommend that users customize main functions and customize startup processes in their own projects."}),"\n",(0,o.jsx)(n.p,{children:"Specifically, you can paste the main copy of Layotto into your project, modify it as necessary, and remove something that is not available (e.g. in a distribution lock component that is not etcd, you can remove it from your main name)"}),"\n",(0,o.jsx)(n.h4,{id:"step-4-compile-run-layotto",children:"Step 4. Compile Run Layotto"}),"\n",(0,o.jsx)(n.p,{children:"Ready to start Layotto."}),"\n",(0,o.jsx)(n.p,{children:"Example hellowd\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"cd ${project_path}/cmd/layotto_multiple_api\ngo build -o layotto\n# run it\n./layotto start -c ../../configs/config_standalone.json\n"})}),"\n",(0,o.jsx)(n.p,{children:"During Layotto launch, each registered API lifecycle method (Init, Register) will be callback to each registered API"}),"\n",(0,o.jsx)(n.p,{children:"Once startup, your API will offer grpc services externally"})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var o=t(6540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);
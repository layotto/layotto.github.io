"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[7637],{3509:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>d});var t=o(4848),r=o(8453);const c={},s="layotto component reference",i={id:"development/component_ref/component_ref",title:"layotto component reference",description:"Background",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/development/component_ref/component_ref.md",sourceDirName:"development/component_ref",slug:"/development/component_ref/",permalink:"/layotto/en-US/docs/development/component_ref/",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/docs/i18n/en-US/docusaurus-plugin-content-docs/current/development/component_ref/component_ref.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Component Development Guide",permalink:"/layotto/en-US/docs/development/developing-component"},next:{title:"How to generate code and documentation from the .proto files",permalink:"/layotto/en-US/docs/api_reference/how_to_generate_api_doc"}},l={},d=[{value:"Background",id:"background",level:2},{value:"Related Designs",id:"related-designs",level:3},{value:"How to configure",id:"how-to-configure",level:3},{value:"How to use",id:"how-to-use",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"layotto-component-reference",children:"layotto component reference"}),"\n",(0,t.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,t.jsxs)(n.p,{children:["When a component starts, it may need to use another component's skill. For example, when the ",(0,t.jsx)(n.code,{children:"sequencer"})," component ",(0,t.jsx)(n.code,{children:"A"})," starts, it needs to read its settings from the ",(0,t.jsx)(n.code,{children:"config"})," component ",(0,t.jsx)(n.code,{children:"B"}),"."]}),"\n",(0,t.jsx)(n.p,{children:'To make this happen, layotto offers the "component reference" feature. This feature lets component A use the features of component B.'}),"\n",(0,t.jsx)(n.h3,{id:"related-designs",children:"Related Designs"}),"\n",(0,t.jsx)(n.p,{children:"Currently, other components can only reference two types of components: ConfigStore and SecretStore. These are used to get configuration and secret keys."}),"\n",(0,t.jsx)(n.p,{children:'The "referenced" components must implement the interface :'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type SetComponent interface {\n    SetConfigStore(cs configstores.Store) (err error)\n    SetSecretStore(ss secretstores.SecretStore) (err error)\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"how-to-configure",children:"How to configure"}),"\n",(0,t.jsxs)(n.p,{children:["You can refer to the configuration file: ",(0,t.jsx)(n.code,{children:"configs/config_ref_example.json"}),", configure the components to be used in the component configuration, and then inject them into the component when the component is initialized."]}),"\n",(0,t.jsx)(n.h3,{id:"how-to-use",children:"How to use"}),"\n",(0,t.jsx)(n.p,{children:"Suppose we are developing a helloword component, it needs to read the secret key from the secret store (for example, to obtain the key to connect to the database) and read the configuration from the config store (for example, to read the IP address of the database to connect to the database) when it starts, then how should we develop the helloword component?"}),"\n",(0,t.jsxs)(n.p,{children:["Take the ",(0,t.jsx)(n.code,{children:"helloword"})," component as an example. First, the ",(0,t.jsx)(n.code,{children:"helloword"})," component needs to implement the ",(0,t.jsx)(n.code,{children:"SetConfigStore"})," and ",(0,t.jsx)(n.code,{children:"SetSecretStore"})," interfaces. The interface implementation is the user's own logic, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'func (hw *HelloWorld) SetConfigStore(cs configstores.Store) (err error) {\n//save for use\nhw.config=cs\nreturn nil\n}\nfunc (hw *HelloWorld) SetSecretStore(ss secretstores.SecretStore) (err error) {\n//save for use\nhw.secretStore = ss\nreturn nil\n}\n//fetch secret/config when component init\nfunc (hw *HelloWorld) Init(config *hello.HelloConfig) error {\n hw.secretStore.GetSecret(secretstores.GetSecretRequest{\n     Name:     "dbPassword",\n  })\n hw.config.Get(context.Background(),&configstores.GetRequest{\n     Keys:     []string{"dbAddress"},\n  })\n return nil\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Then configure other components that need to be injected to the helloworld component in the configuration file, for example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'        {\n  "helloworld": {\n    "type": "helloworld",\n    "hello": "greeting",\n    "secret_ref": [\n      {\n        "store_name": "local.file",\n        "key": "db-user-pass:password",\n        "sub_key": "db-user-pass:password",\n        "inject_as": "redisPassword"\n      }\n    ],\n    "component_ref": {\n      "config_store": "config_demo",\n      "secret_store": "local.file"\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"helloword"})," component can use the ",(0,t.jsx)(n.code,{children:"config_demo"})," and ",(0,t.jsx)(n.code,{children:"local.file"})," components during initialization"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>i});var t=o(6540);const r={},c=t.createContext(r);function s(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[5834],{9220:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=t(4848),r=t(8453);const o={},s="Layotto go-sdk Reference",a={id:"sdk_reference/go/start",title:"Layotto go-sdk Reference",description:"Start from HelloWorld",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/sdk_reference/go/start.md",sourceDirName:"sdk_reference/go",slug:"/sdk_reference/go/start",permalink:"/layotto/en-US/docs/sdk_reference/go/start",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/sdk_reference/go/start.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"gRPC API reference",permalink:"/layotto/en-US/docs/api_reference/"},next:{title:"Introduction to Layotto configuration file",permalink:"/layotto/en-US/docs/configuration/overview"}},l={},c=[{value:"Start from HelloWorld",id:"start-from-helloworld",level:2},{value:"go-sdk simple usage",id:"go-sdk-simple-usage",level:3},{value:"The go-sdk code",id:"the-go-sdk-code",level:3},{value:"Configuration files",id:"configuration-files",level:3},{value:"Initialize Client",id:"initialize-client",level:2},{value:"Experience other interface functions",id:"experience-other-interface-functions",level:2},{value:"Experience the GRPC interface",id:"experience-the-grpc-interface",level:2},{value:"runtimeAPI interface",id:"runtimeapi-interface",level:3},{value:"Extension interface",id:"extension-interface",level:2},{value:"More Examples",id:"more-examples",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"layotto-go-sdk-reference",children:"Layotto go-sdk Reference"}),"\n",(0,i.jsx)(n.h2,{id:"start-from-helloworld",children:"Start from HelloWorld"}),"\n",(0,i.jsx)(n.h3,{id:"go-sdk-simple-usage",children:"go-sdk simple usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# 1. Execute the following commands sequentially in the root directory of the project\n# build a layotto binary program, and add it to the environment variables for easy subsequent operations\ncd cmd/layotto\ngo build -o layotto\nexport PATH=$PATH:$(pwd)/layotto\n\n# 2.Run layotto according to the configuration file\nlayotto start -c ../../configs/config_hello.json\n\n# 3.Start another terminal and launch the go sdk client program\ncd demo/hello/common\ngo build -o client\n./client -s helloworld\n\n## output:\nruntime client initializing for: 127.0.0.1:34904\ngreeting\n"})}),"\n",(0,i.jsx)(n.h3,{id:"the-go-sdk-code",children:"The go-sdk code"}),"\n",(0,i.jsxs)(n.p,{children:["Briefly observe the usage process of ",(0,i.jsx)(n.code,{children:"client"}),", and the source code is placed in ",(0,i.jsx)(n.code,{children:"demo/hello/common/client.go"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'var storeName string\n\nfunc init() {\n\tflag.StringVar(&storeName, "s", "", "set `storeName`")\n}\n\nfunc main() {\n    flag.Parse()\n    if storeName == "" {\n\t\tpanic("storeName is empty.")\n\t}\n    \n    // Create a connection using the default IP port 127.0.0.1:34904, which is also the default startup port for local Layotto\n\tcli, err := client.NewClient()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n    // Close grpc connection\n\tdefer cli.Close()\t\n\t\n\t// call the interface, send request\n\tres, err := cli.SayHello(context.Background(), &client.SayHelloRequest{\n\t\tServiceName: storeName,\n\t})\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tfmt.Println(res.Hello)\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-files",children:"Configuration files"}),"\n",(0,i.jsx)(n.p,{children:"Start Layotto and test the HelloWorld program above by using the simplest configuration file, the content is as follows:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["For a more detailed introduction to configuration files, please refer to ",(0,i.jsx)(n.a,{href:"/layotto/en-US/docs/configuration/overview",children:"configuration"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "servers": [\n    {\n      "default_log_path": "stdout",\n      "default_log_level": "DEBUG",\n      "listeners": [\n        {\n          "name": "grpc",\n          "address": "127.0.0.1:34904",\n          "bind_port": true,\n          "filter_chains": [\n            {\n              "filters": [\n                {\n                  "type": "grpc",\n                  "config": {\n                    "server_name": "runtime",\n                    "grpc_config": {  \n                      "hellos": {\n                        "helloworld": {\n                          "type": "helloworld",\n                          "hello": "greeting"\n                        }\n                      }\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In the above process, Layotto registers components in the ",(0,i.jsx)(n.code,{children:"grpc_config"})," attribute in the configuration file."]}),"\n",(0,i.jsxs)(n.p,{children:["The interface type of the component implementation is ",(0,i.jsx)(n.code,{children:"hellos"}),", and multiple instance instances can be supported to implement this interface.\nThe instance attribute in the configuration file is used to distinguish the instance names of different implementations of this interface.\nIn the above configuration file, only one instance ",(0,i.jsx)(n.code,{children:"helloworld"})," is involved."]}),"\n",(0,i.jsxs)(n.p,{children:["When using go sdk to call hello related services, such as ",(0,i.jsx)(n.code,{children:"SayHello"})," in the program, the name of the instance needs to be specified.\nThe above code uses the ",(0,i.jsx)(n.code,{children:"ServiceName"})," parameter to pass the instance name, indicating that the specified instance is used to operate this request"]}),"\n",(0,i.jsxs)(n.p,{children:["There are two sub attributes in the instance attribute ",(0,i.jsx)(n.code,{children:"type"})," and ",(0,i.jsx)(n.code,{children:"hello"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),", this attribute is unique to every instance, indicating which type is used to implement the interface. Here, it is the ",(0,i.jsx)(n.code,{children:"hellowrold"})," type which is already been registered as a component type in ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/6f6508b11783f1e4fa947ff47632e74064333384/cmd/layotto/main.go#LL275C1-L275C1",children:"Layotto"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hello"}),", this attribute is used to initialize components, and different types of interfaces have different attribute fields. Different instance also have different attribute field to initialize. Use ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/6f6508b11783f1e4fa947ff47632e74064333384/components/hello/hello.go#L32-L36",children:"code"})," to view the usage of relevant configuration."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"initialize-client",children:"Initialize Client"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["The initialization methods currently supported by ",(0,i.jsx)(n.code,{children:"go sdk"})]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// Use the default port "34904", or you can use "runtime_GRPC_Set" the port for the PORT environment variable and use the default IP address "127.0.0.1" to internally call the NewClientWithPort function\nNewClient() (client Client, err error)\n\n// Provide port input parameters, use the default IP address "127.0.0.1", and internally call the NewClientWithAddress function\nNewClientWithPort(port string) (client Client, err error)\n\n// The address is required to be passed in, that is, in the form of <ip:port>. After creating the GRPC conn, call NewClientWithConnection\nNewClientWithAddress(address string) (client Client, err error)\n\n// Encapsulate the GRPC connection created by the user into a client\nNewClientWithConnection(conn *grpc.ClientConn) Client\n'})}),"\n",(0,i.jsx)(n.h2,{id:"experience-other-interface-functions",children:"Experience other interface functions"}),"\n",(0,i.jsxs)(n.p,{children:["Taking the distributed id ",(0,i.jsx)(n.code,{children:"sequencer"})," as an example, use the 'redis' type. Please refer to this [document](component_specs/sequencer/redis. md) for relevant parameters usage."]}),"\n",(0,i.jsxs)(n.p,{children:["Please refer to ",(0,i.jsx)(n.code,{children:"demo/sequencer/common/client.go"})," for specific code configuration, as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'const (\n    key = "key666"\n)\n\nvar storeName string\n\nfunc init() {\n    flag.StringVar(&storeName, "s", "", "set `storeName`")\n}\n\nfunc main() {\n    cli, err := client.NewClient()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer cli.Close()\n\tctx := context.Background()\n\tfmt.Printf("Try to get next id.Key:%s \\n", key)\n\tfor i := 0; i < 10; i++ {\n        \n\t\t// get the next sequencer id\n\t\tid, err := cli.GetNextId(ctx, &runtimev1pb.GetNextIdRequest{\n\t\t\t// Here is the storename, which is the instance name mentioned earlier and needs to be \n\t\t\t// consistent with the instance filled in the configuration file\n\t\t\tStoreName: storeName, \n\t\t\tKey:       key,\n\t\t\tOptions:   nil,\n\t\t\tMetadata:  nil,\n\t\t})\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\t\tfmt.Printf("Next id:%v \\n", id)\n\t}\n\tfmt.Println("Demo success!")\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Some parameters when using ",(0,i.jsx)(n.code,{children:"GetNextId"})," interface:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["StoreName: Indicates the name of the instance processing this request, which is consistent with the role of ",(0,i.jsx)(n.code,{children:"ServiceName"})," in the ",(0,i.jsx)(n.code,{children:"SayHello"})," interface mentioned earlier."]}),"\n",(0,i.jsx)(n.li,{children:"Key: Distributed ID namespaces allow different namespaces to use the same distributed ID"}),"\n",(0,i.jsxs)(n.li,{children:["Options: Fill in the mode of ID generation, with ",(0,i.jsx)(n.strong,{children:"strong"})," and ",(0,i.jsx)(n.strong,{children:"weak"})," options to choose from. The ID generated by the ",(0,i.jsx)(n.strong,{children:"strong"})," mode is definitely larger than the ID from the previous request, but there may be some performance loss. The ",(0,i.jsx)(n.strong,{children:"weak"})," mode has performance advantages, but cannot meet the requirement that the ID is definitely larger than the previous one. By default, use the weak mode to generate id."]}),"\n",(0,i.jsxs)(n.li,{children:["Metadata: Other parameters. Different types of instances require different metadata for customized construction. For example, ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/6f6508b11783f1e4fa947ff47632e74064333384/components/pkg/utils/mysql.go#L42-L60",children:"MySQL"})," The sequencer supports using metadata to pass information such as ",(0,i.jsx)(n.code,{children:"tableName"}),", ",(0,i.jsx)(n.code,{children:"defaultPassword"}),", and ",(0,i.jsx)(n.code,{children:"userName"}),", while instances of Redis type do not need to pass metadata\nreturns:"]}),"\n",(0,i.jsx)(n.li,{children:"next_id: The distributed id."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["For detailed useage of interface, you can refer to the ",(0,i.jsx)(n.a,{href:"https://mosn.io/layotto/#/en/design/sequencer/design",children:"API design docs"}),"\nPerhaps the document has not been supplemented yet, you can still view the ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/6f6508b11783f1e4fa947ff47632e74064333384/spec/proto/runtime/v1/runtime.pb.go#L1118-L1131",children:"relecant code comments"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The relevant parameter configuration parameters are as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"sequencer": {\n    "sequencer_demo": {\n        "type": "redis",\n        "metadata": {\n            "redisHost": "127.0.0.1:6380",\n            "redisPassword": ""\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Launch the application for verification"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'# use docker to start redis\ndocker run --name layotto-redis -itd -p 6380:6379 redis \n\n# start layotto\ncd configs\nlayotto start -c config_redis.json \n\n# Start another terminal and start the client program\ncd demo/sequencer/common\ngo build -o client\n./client -s sequencer_demo\n\n# output\nruntime client initializing for: 127.0.0.1:34904\nTry to get next id.Key:key666\nNext id:next_id:1\nNext id:next_id:2\nNext id:next_id:3\nNext id:next_id:4\nNext id:next_id:5\nNext id:next_id:6\nNext id:next_id:7\nNext id:next_id:8\nNext id:next_id:9\nNext id:next_id:10\nDemo success!\n\n\n# exec into redis container and check the key.\ndocker exec -it layotto-redis redis-cli -h localhost -p 6379\nlocalhost:6379> keys *\n1) "sequencer|||app1||key666"\nlocalhost:6379> get "sequencer|||app1||key666"\n"10000"\n\n'})}),"\n",(0,i.jsx)(n.h2,{id:"experience-the-grpc-interface",children:"Experience the GRPC interface"}),"\n",(0,i.jsx)(n.p,{children:"Currently, go-sdk only encapsulates GRPC with a thin layer, so for interfaces that are not synchronized in go sdk, GRPC can be used for calling"}),"\n",(0,i.jsx)(n.h3,{id:"runtimeapi-interface",children:"runtimeAPI interface"}),"\n",(0,i.jsxs)(n.p,{children:["Here, take the ",(0,i.jsx)(n.code,{children:"local"})," component type in the ",(0,i.jsx)(n.code,{children:"file"})," interface as an example."]}),"\n",(0,i.jsxs)(n.p,{children:["You can view the proto files in ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/tree/main/spec/proto/runtime/v1",children:(0,i.jsx)(n.code,{children:"spec/proto/runtime"})})," or the ",(0,i.jsx)(n.a,{href:"/layotto/en-US/docs/api_reference/",children:"GRPC API docs"})]}),"\n",(0,i.jsxs)(n.p,{children:["The complete code reference is ",(0,i.jsx)(n.code,{children:"demo/file/local/client.go"}),", and the content is as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// create grpc connection, packaged as a runtimeclient\nfunc main() {\n\t// conn to layotto grpc server with row grpc client\n\tconn, err := grpc.Dial("127.0.0.1:34904", grpc.WithInsecure())\n\tif err != nil {\n\t\tfmt.Printf("conn build failed,err:%+v", err)\n\t\treturn\n\t}\n\n \tc := runtimev1pb.NewRuntimeClient(conn)\n    \n    // call file\'s interface\n    // ....\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Creating ",(0,i.jsx)(n.code,{children:"Put"})," in local mode requires setting the ",(0,i.jsx)(n.code,{children:"FileMode"})," and ",(0,i.jsx)(n.code,{children:"FileFlag"})," parameters in metadata to create files."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// layotto server\nfunc (lf *LocalStore) Put(ctx context.Context, f *file.PutFileStu) error {\n\t// Here, you need to set the FileMode and FileFlag parameters using the metadata\n    mode, ok := f.Metadata[FileMode]\n\tif !ok {\n\t\treturn fmt.Errorf("fileMode is required for put file")\n\t}\n\tflag, ok := f.Metadata[FileFlag]\n\tif !ok {\n\t\treturn fmt.Errorf("fileFlag is required for put file")\n\t}\n\t// ....\n}\n\n\n// client\nfunc main() {\n    // grpc conn and set runtime client\n   \n\tmeta := make(map[string]string)\n\tmeta["FileMode"] = "0644"\n\tmeta["FileFlag"] = strconv.Itoa(os.O_CREATE | os.O_RDWR)\n\treq := &runtimev1pb.PutFileRequest{StoreName: StoreName, Name: FileName, Metadata: meta}\n\tstream, err := c.PutFile(context.Background())\n\t// ...\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"extension-interface",children:"Extension interface"}),"\n",(0,i.jsxs)(n.p,{children:["At present, some building interfaces such as SMS, encryption, email, etc in go sdk are not included in the ",(0,i.jsx)(n.code,{children:"runtimeAPI"})," service, but instead use interface interfaces generated by proto.\nSo when using this type of interface, you can directly call the grpc interface.\nRelated interface documents refer to the proto file in the ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/tree/main/spec/proto/extension/v1",children:"spec directory"})]}),"\n",(0,i.jsx)(n.p,{children:"Taking the email interface as an example, the content is as follows:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"The interface is still under construction and there is no component implementation, so it cannot be truly called. The following is only a simple example"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"func main() {\n\tcli, err := client.NewClient()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t\n\tdefer cli.Close()\n\n\ttemplate, err := cli.SendEmailWithTemplate(context.TODO(), &pb.SendEmailWithTemplateRequest{})\n\tif err != nil {\n\t\tfmt.Println(err)\n\t\treturn \n\t}\n\t\n\tfmt.Println(template.String())\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"more-examples",children:"More Examples"}),"\n",(0,i.jsxs)(n.p,{children:["For other SDK interfaces, please refer to the code examples in the ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/tree/main/demo",children:"demo directory"})," and ",(0,i.jsx)(n.a,{href:"start/state/state.md",children:"quick start startup document"})]}),"\n",(0,i.jsxs)(n.p,{children:["Refer to the ",(0,i.jsx)(n.a,{href:"https://github.com/mosn/layotto/tree/main/configs",children:"configs example"})," for writing relevant configuration files and ",(0,i.jsx)(n.a,{href:"/layotto/en-US/docs/configuration/overview",children:"Component Configuration Document"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(6540);const r={},o=i.createContext(r);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);
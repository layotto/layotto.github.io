"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[4600],{7190:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>l,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var o=n(4848),i=n(8453);const s={},r="Development specification when adding API",a={id:"development/developing-api",title:"Development specification when adding API",description:"Thank you for your support in Layotto!",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/development/developing-api.md",sourceDirName:"development",slug:"/development/developing-api",permalink:"/layotto/en-US/docs/development/developing-api",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/development/developing-api.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Comment specification of proto file",permalink:"/layotto/en-US/docs/api_reference/comment_spec_of_proto"},next:{title:"Layotto GitHub Workflows",permalink:"/layotto/en-US/docs/development/github-workflows"}},c={},d=[{value:"Too long; Don&#39;t read",id:"too-long-dont-read",level:2},{value:"1\u3001Publish API proposal to the community and have a full discussion",id:"1publish-api-proposal-to-the-community-and-have-a-full-discussion",level:2},{value:"1.1. Publish a detailed proposal",id:"11-publish-a-detailed-proposal",level:3},{value:"1.1.1. Why the proposal should be detailed",id:"111-why-the-proposal-should-be-detailed",level:4},{value:"1.1.2. The content of the proposal",id:"112-the-content-of-the-proposal",level:4},{value:"1.2. Proposal review",id:"12-proposal-review",level:3},{value:"2\u3001Development",id:"2development",level:2},{value:"2.1. Code specification",id:"21-code-specification",level:3},{value:"2.2. Test Specification",id:"22-test-specification",level:3},{value:"2.3. Document specification",id:"23-document-specification",level:3},{value:"2.3.1. Quick start",id:"231-quick-start",level:4},{value:"2.3.2. Using document",id:"232-using-document",level:4},{value:"What is this API? What is the problem to solve",id:"what-is-this-api-what-is-the-problem-to-solve",level:5},{value:"What scenarios are appropriate for using this API",id:"what-scenarios-are-appropriate-for-using-this-api",level:5},{value:"How to use this API",id:"how-to-use-this-api",level:5},{value:"Why is it designed this way?",id:"why-is-it-designed-this-way",level:5},{value:"2.3.3. This document describes the general CONFIGURATION of the API",id:"233-this-document-describes-the-general-configuration-of-the-api",level:4},{value:"2.3.4. Documents that describe component configuration",id:"234-documents-that-describe-component-configuration",level:4},{value:"2.4. Annotation specifications",id:"24-annotation-specifications",level:3},{value:"proto comment as doc",id:"proto-comment-as-doc",level:4},{value:"Component API comment as doc",id:"component-api-comment-as-doc",level:4},{value:"Other Matters needing attention",id:"other-matters-needing-attention",level:4},{value:"3\u3001Submit a pull request",id:"3submit-a-pull-request",level:2},{value:"3.1. Pr that does not conform to the development specification may not be incorporated into the trunk",id:"31-pr-that-does-not-conform-to-the-development-specification-may-not-be-incorporated-into-the-trunk",level:3},{value:"3.2. The number of cr",id:"32-the-number-of-cr",level:3}];function h(e){const t={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"development-specification-when-adding-api",children:"Development specification when adding API"}),"\n",(0,o.jsx)(t.p,{children:"Thank you for your support in Layotto!"}),"\n",(0,o.jsxs)(t.p,{children:["This document describes how to design and implement a new Layotto API. Layotto is written in Go , if you are not familiar with Go, you can check it out ",(0,o.jsx)(t.a,{href:"https://tour.golang.org/welcome/1",children:"Go Tutorial"})," \u3002"]}),"\n",(0,o.jsx)(t.p,{children:"When developing a new API, you can refer to the code and documentation of other existing APIs, which will make the development much easier."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Q: Why should the specification be formulated?"})}),"\n",(0,o.jsx)(t.p,{children:"A: Currently there is a lack of documentation, which makes it difficult for users to use;"}),"\n",(0,o.jsxs)(t.p,{children:["Contributors can't understand code due to the lack of comments, such as : ",(0,o.jsx)(t.a,{href:"https://github.com/mosn/layotto/issues/112",children:"https://github.com/mosn/layotto/issues/112"})]}),"\n",(0,o.jsx)(t.p,{children:"It's time-consuming to make up comments for previous documents. We hope future development will contain these."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Q: Following the specification is too much trouble, will it discourage developers who want to contribute code?"})}),"\n",(0,o.jsxs)(t.p,{children:["A: ",(0,o.jsx)(t.strong,{children:'This specification only restricts "what is needed when adding a new Layotto API" (such as a new API to generate distributed self-incrementing id)'}),", other prs, such as adding a new component or a new SDK, do not need to follow this specification and are free enough."]}),"\n",(0,o.jsx)(t.h2,{id:"too-long-dont-read",children:"Too long; Don't read"}),"\n",(0,o.jsx)(t.p,{children:"Proposal before development.Make sure the proposal is detailed enough."}),"\n",(0,o.jsx)(t.p,{children:"Write four documents for users"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Quick start"}),"\n",(0,o.jsx)(t.li,{children:"Usage document"}),"\n",(0,o.jsx)(t.li,{children:"API common configuration"}),"\n",(0,o.jsx)(t.li,{children:"Component configuration"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"No need to write design documents, but you need to write detailed comments for proto API and component API and take the comments as doc."}),"\n",(0,o.jsx)(t.p,{children:"The pr of the new API requires two people to code review."}),"\n",(0,o.jsx)(t.h2,{id:"1publish-api-proposal-to-the-community-and-have-a-full-discussion",children:"1\u3001Publish API proposal to the community and have a full discussion"}),"\n",(0,o.jsx)(t.h3,{id:"11-publish-a-detailed-proposal",children:"1.1. Publish a detailed proposal"}),"\n",(0,o.jsx)(t.h4,{id:"111-why-the-proposal-should-be-detailed",children:"1.1.1. Why the proposal should be detailed"}),"\n",(0,o.jsx)(t.p,{children:"If the proposal is not detailed enough, there is nothing worthy of review by others, and no problem can be found;"}),"\n",(0,o.jsx)(t.p,{children:"The purpose of the review is to brainstorm ideas, and everyone will help analyze the shortcomings of the current design, expose the problems as soon as possible, and avoid rework later."}),"\n",(0,o.jsx)(t.h4,{id:"112-the-content-of-the-proposal",children:"1.1.2. The content of the proposal"}),"\n",(0,o.jsx)(t.p,{children:"The proposal needs to include the following:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["demand analysis","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Why create this API"}),"\n",(0,o.jsx)(t.li,{children:"Define the boundary of the requirements, which features support and which do not support"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.li,{children:"Product research on the market"}),"\n",(0,o.jsx)(t.li,{children:"grpc/http API design"}),"\n",(0,o.jsx)(t.li,{children:"Component API design"}),"\n",(0,o.jsx)(t.li,{children:"Explain your design"}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["An example of an excellent proposal\uff1a",(0,o.jsx)(t.a,{href:"https://github.com/dapr/dapr/issues/2988",children:"https://github.com/dapr/dapr/issues/2988"})]}),"\n",(0,o.jsx)(t.h3,{id:"12-proposal-review",children:"1.2. Proposal review"}),"\n",(0,o.jsx)(t.p,{children:"After submitting the proposal, everyone can discuss it in text;"}),"\n",(0,o.jsx)(t.p,{children:"For important or complex API, we can hold community meetings for design review."}),"\n",(0,o.jsx)(t.h2,{id:"2development",children:"2\u3001Development"}),"\n",(0,o.jsx)(t.h3,{id:"21-code-specification",children:"2.1. Code specification"}),"\n",(0,o.jsx)(t.p,{children:"TODO"}),"\n",(0,o.jsx)(t.h3,{id:"22-test-specification",children:"2.2. Test Specification"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Unit test"}),"\n",(0,o.jsx)(t.li,{children:"Client demo, which can be used for demonstration and integration testing"}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"23-document-specification",children:"2.3. Document specification"}),"\n",(0,o.jsx)(t.p,{children:"Principle: A user guide is required. However, a design doc for developers is optional, since it may be expired or inconsistent after a period of time. Posting links to the proposal issue and having comments in the code will be sufficient."}),"\n",(0,o.jsx)(t.h4,{id:"231-quick-start",children:"2.3.1. Quick start"}),"\n",(0,o.jsx)(t.p,{children:"need to have:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"What can this API do"}),"\n",(0,o.jsx)(t.li,{children:"What does this quickstart do? What effect you want to achieve? It\u2019s better to provide a picture for illustration"}),"\n",(0,o.jsx)(t.li,{children:"Steps of operation"}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Correct example\uff1a",(0,o.jsx)(t.a,{href:"https://github.com/dapr/quickstarts/tree/v1.0.0/pub-sub",children:"Dapr pub-sub quickstart"}),"\nBefore the operation, explain what effect this demo want to achieve with illustration"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"img.png",src:n(7649).A+"",width:"2741",height:"1549"})}),"\n",(0,o.jsx)(t.p,{children:"Counter-example: The document only writes operation steps 1234, and users do not understand what they want to do."}),"\n",(0,o.jsx)(t.h4,{id:"232-using-document",children:"2.3.2. Using document"}),"\n",(0,o.jsxs)(t.p,{children:['The documentation path is under "Reference - API reference", for example, see ',(0,o.jsx)(t.a,{href:"https://mosn.io/layotto/#/en/api_reference/state/reference",children:"State API"})]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsx)(t.p,{children:"The study found that Dapr has a lot of documentation, such as the State API:"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://docs.dapr.io/developing-applications/building-blocks/state-management/",children:"https://docs.dapr.io/developing-applications/building-blocks/state-management/"}),(0,o.jsx)(t.br,{}),"\n",(0,o.jsx)(t.a,{href:"https://docs.dapr.io/reference/api/state_api/",children:"https://docs.dapr.io/reference/api/state_api/"})]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.a,{href:"https://docs.dapr.io/operations/components/setup-state-store/",children:"https://docs.dapr.io/operations/components/setup-state-store/"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.a,{href:"https://docs.dapr.io/reference/components-reference/supported-state-stores/",children:"https://docs.dapr.io/reference/components-reference/supported-state-stores/"})}),"\n",(0,o.jsx)(t.p,{children:"Since we are in the early stages of the project, Layotto documentation can be slightly less"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Need to have \uff1a"}),"\n",(0,o.jsx)(t.h5,{id:"what-is-this-api-what-is-the-problem-to-solve",children:"What is this API? What is the problem to solve"}),"\n",(0,o.jsx)(t.h5,{id:"what-scenarios-are-appropriate-for-using-this-api",children:"What scenarios are appropriate for using this API"}),"\n",(0,o.jsx)(t.h5,{id:"how-to-use-this-api",children:"How to use this API"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"List of interfaces.For example\uff1a"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"img_4.png",src:n(6076).A+"",width:"518",height:"519"})}),"\n",(0,o.jsx)(t.p,{children:"List out which interfaces are there. On the one hand, the users of the province go to the proto and don\u2019t know which APIs are related. On the other hand, it can avoid the disgust of users due to the lack of interface documentation"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"About the interface`s input and output parameters: use proto comments as interface documentation\nConsidering that the interface document needs to be written in Both Chinese and English and may be inconsistent with the code after a long time, it is recommended not to write the interface document but to write the proTO comment in sufficient detail as the interface document. Such as:"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-protobuf",children:"// GetStateRequest is the message to get key-value states from specific state store.\nmessage GetStateRequest {\n  // Required. The name of state store.\n  string store_name = 1;\n\n  // Required. The key of the desired state\n  string key = 2;\n\n  // (optional) read consistency mode\n  StateOptions.StateConsistency consistency = 3;\n\n  // (optional) The metadata which will be sent to state store components.\n  map<string, string> metadata = 4;\n}\n   \n// StateOptions configures concurrency and consistency for state operations\nmessage StateOptions {\n  // Enum describing the supported concurrency for state.\n  // The API server uses Optimized Concurrency Control (OCC) with ETags.\n  // When an ETag is associated with an save or delete request, the store shall allow the update only if the attached ETag matches with the latest ETag in the database.\n  // But when ETag is missing in the write requests, the state store shall handle the requests in the specified strategy(e.g. a last-write-wins fashion).\n  enum StateConcurrency {\n    CONCURRENCY_UNSPECIFIED = 0;\n    // First write wins\n    CONCURRENCY_FIRST_WRITE = 1;\n    // Last write wins\n    CONCURRENCY_LAST_WRITE = 2;\n  }\n  // Enum describing the supported consistency for state.\n  enum StateConsistency {\n    CONSISTENCY_UNSPECIFIED = 0;\n    //  The API server assumes data stores are eventually consistent by default.A state store should:\n    //\n    // - For read requests, the state store can return data from any of the replicas\n    // - For write request, the state store  should asynchronously replicate updates to configured quorum after acknowledging the update request.\n    CONSISTENCY_EVENTUAL = 1;\n\n    // When a strong consistency hint is attached, a state store should:\n    //\n    // - For read requests, the state store should return the most up-to-date data consistently across replicas.\n    // - For write/delete requests, the state store should synchronisely replicate updated data to configured quorum before completing the write request.\n    CONSISTENCY_STRONG = 2;\n  }\n\n  StateConcurrency concurrency = 1;\n  StateConsistency consistency = 2;\n}\n"})}),"\n",(0,o.jsx)(t.p,{children:"Clear comment should to be written \uff1a"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Mandatory parameter or optional parameter\uff1b"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Explain what this field means; It is not enough to just explain the literal meaning. It is necessary to explain the usage mechanism behind it. For example, the consistency and concurrency above should explain what kind of guarantee the server can provide after the user passes a certain option."}),"\n",(0,o.jsx)(t.p,{children:"(The comments on consistency and concurrency are actually pasted after simplifying the description on the Dapr document, saving the need to write bilingual documents.)"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"If the comment is not clear, explain it on the document"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h5,{id:"why-is-it-designed-this-way",children:"Why is it designed this way?"}),"\n",(0,o.jsx)(t.p,{children:"Post a document link if there is a design document or a proposal issue link if there is no document"}),"\n",(0,o.jsx)(t.h4,{id:"233-this-document-describes-the-general-configuration-of-the-api",children:"2.3.3. This document describes the general CONFIGURATION of the API"}),"\n",(0,o.jsxs)(t.p,{children:["For example: ",(0,o.jsx)(t.a,{href:"https://mosn.io/layotto/#/zh/component_specs/state/common",children:"https://mosn.io/layotto/#/zh/component_specs/state/common"})]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Configuration file structure"}),"\n",(0,o.jsx)(t.li,{children:"Explain the general configuration of the API, such as keyPrefix"}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"234-documents-that-describe-component-configuration",children:"2.3.4. Documents that describe component configuration"}),"\n",(0,o.jsxs)(t.p,{children:["For example: ",(0,o.jsx)(t.a,{href:"https://mosn.io/layotto/#/zh/component_specs/state/redis",children:"https://mosn.io/layotto/#/zh/component_specs/state/redis"})]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Configuration item description for this component"}),"\n",(0,o.jsx)(t.li,{children:"If you want to start this component and run the demo, how to start it"}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"24-annotation-specifications",children:"2.4. Annotation specifications"}),"\n",(0,o.jsx)(t.h4,{id:"proto-comment-as-doc",children:"proto comment as doc"}),"\n",(0,o.jsx)(t.p,{children:"See above"}),"\n",(0,o.jsx)(t.h4,{id:"component-api-comment-as-doc",children:"Component API comment as doc"}),"\n",(0,o.jsx)(t.p,{children:"If you don't write a bilingual design document, Then the annotation of the component API should carry the role of the design document (explain to other developers). You can post the link of proposal Issue"}),"\n",(0,o.jsx)(t.p,{children:'The criterion for judging good writing is "After sending it out, if community enthusiasts want to contribute components, can they not ask questions face-to-face and see the project for themselves to get started developing components"'}),"\n",(0,o.jsx)(t.p,{children:"If you feel that the explanation is not clear, write a design document, or add a proposal issue and write in more detail"}),"\n",(0,o.jsx)(t.h4,{id:"other-matters-needing-attention",children:"Other Matters needing attention"}),"\n",(0,o.jsx)(t.p,{children:"Make sure there are no Chinese comments\uff1b"}),"\n",(0,o.jsx)(t.p,{children:"Don't write meaningless comments (repeat method names), such as\uff1a"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-protobuf",children:"//StopSubscribe stop subs\nStopSubscribe()\n"})}),"\n",(0,o.jsx)(t.h2,{id:"3submit-a-pull-request",children:"3\u3001Submit a pull request"}),"\n",(0,o.jsx)(t.h3,{id:"31-pr-that-does-not-conform-to-the-development-specification-may-not-be-incorporated-into-the-trunk",children:"3.1. Pr that does not conform to the development specification may not be incorporated into the trunk"}),"\n",(0,o.jsx)(t.h3,{id:"32-the-number-of-cr",children:"3.2. The number of cr"}),"\n",(0,o.jsx)(t.p,{children:"The code review of the new API requires two people to review, and the photo is automatically checked by a robot and changed to one person for review."}),"\n",(0,o.jsx)(t.p,{children:"Other people who pull the request are random and not bound."})]})}function l(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},7649:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/img-0552604923c4cb9b5ac7ab0bc78a8cf4.png"},6076:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/img_4-8f7a4509630d3e6fa2113fc489fb0e78.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var o=n(6540);const i={},s=o.createContext(i);function r(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);
"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[1782],{6240:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var o=t(4848),s=t(8453);const r={},i="Sequencer API component",a={id:"component_specs/sequencer/common",title:"Sequencer API component",description:"Configuration file structure",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/component_specs/sequencer/common.md",sourceDirName:"component_specs/sequencer",slug:"/component_specs/sequencer/common",permalink:"/layotto/en-US/docs/component_specs/sequencer/common",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/component_specs/sequencer/common.md",tags:[],version:"current",frontMatter:{}},c={},d=[];function h(e){const n={a:"a",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"sequencer-api-component",children:"Sequencer API component"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Configuration file structure"})}),"\n",(0,o.jsx)(n.p,{children:"The json configuration file has the following structure:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'"sequencer": {\n  "<Component A Name>": {\n    "type": "Component A Name",\n    "biggerThan": {\n      "<KEY>": "<VALUE>",\n      "<KEY>": "<VALUE>"\n    },\n    "metadata": {\n      "<KEY>": "<VALUE>",\n      "<KEY>": "<VALUE>"\n    }\n  },\n  "<Component B Name>": {\n    "type": "Component B Name",\n    "biggerThan": {\n      "<KEY>": "<VALUE>",\n      "<KEY>": "<VALUE>"\n    },\n    "metadata": {\n      "<KEY>": "<VALUE>",\n      "<KEY>": "<VALUE>"\n    }\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You can configure the key/value configuration items that the component cares about in the metadata. For example, ",(0,o.jsx)(n.a,{href:"https://github.com/mosn/layotto/blob/main/configs/runtime_config.json",children:"Etcd component configuration"})," is as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'"sequencer": {\n  "sequencer_demo": {\n    "type": "etcd",\n    "biggerThan": {\n      "key1": 1,\n      "key2": 111\n    },\n    "metadata": {\n      "endpoints": "localhost:2379",\n      "segmentCacheEnable": "false",\n      "segmentStep": "1",\n      "username": "",\n      "password": "",\n      "dialTimeout": "5"\n    }\n  }\n},\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Common configuration item description"})}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Field"}),(0,o.jsx)(n.th,{children:"Required"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"biggerThan"}),(0,o.jsx)(n.td,{children:"N"}),(0,o.jsx)(n.td,{children:'All IDs generated by components are required to be larger than "biggerThan". This configuration item is designed to make apps portable. For example, the system originally used mysql as the id generating service and the id has been generated to 1000. If you want to migrate your system to PostgreSQL, you need to configure biggerThan to 1000, so that the PostgreSQL component will be set when it is initialized, and the id will be forced to be above 1000, or an error will be returned during startup if the requirements cannot be met.'})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"segmentCacheEnable"}),(0,o.jsx)(n.td,{children:"N"}),(0,o.jsx)(n.td,{children:"Whether to enable number segment caching. The default value is true"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"segmentStep"}),(0,o.jsx)(n.td,{children:"N"}),(0,o.jsx)(n.td,{children:"The size of each number segment cache, the default value is 50"})]})]})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"What is segment cache?"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The original solution was to read and write the database every time the ID was obtained, which caused great pressure on the database. The design purpose of segment mode is to cache some ids in the sidecar in advance (cache all ids in a range) to reduce the database pressure."}),"\n",(0,o.jsx)(n.p,{children:"Specifically, Layotto obtains ids in batches from the sequencer component each time. After the cache runs out, Layotto invokes the component again, and the component goes to the database to obtain a new number segment, which can greatly reduce the pressure on the database."}),"\n",(0,o.jsxs)(n.p,{children:["This design refers to ",(0,o.jsx)(n.a,{href:"https://tech.meituan.com/2017/04/21/mt-leaf.html",children:"Meituan Leaf's design"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Other configuration items"})}),"\n",(0,o.jsx)(n.p,{children:"In addition to the above general configuration items, each component has its own special configuration items. Please refer to the documentation for each component."})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(6540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);
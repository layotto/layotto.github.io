"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[7445],{2289:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var r=n(4848),o=n(8453);const s={},i=void 0,l={id:"start/stream_filter/flow_control",title:"flow_control",description:"\u67e5\u770b\u4e2d\u6587\u7248\u672c",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/start/stream_filter/flow_control.md",sourceDirName:"start/stream_filter",slug:"/start/stream_filter/flow_control",permalink:"/layotto/en-US/docs/start/stream_filter/flow_control",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/start/stream_filter/flow_control.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Dump TCP traffic",permalink:"/layotto/en-US/docs/start/network_filter/tcpcopy"},next:{title:"Use Layotto Actuator for health check and metadata query",permalink:"/layotto/en-US/docs/start/actuator/start"}},c={},d=[{value:"Method Level Flow Control",id:"method-level-flow-control",level:2},{value:"Introduction",id:"introduction",level:3},{value:"Configuration Description",id:"configuration-description",level:3}];function h(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"/layotto/en-US/docs/start/stream_filter/flow_control",children:"\u67e5\u770b\u4e2d\u6587\u7248\u672c"})}),"\n",(0,r.jsx)(t.h2,{id:"method-level-flow-control",children:"Method Level Flow Control"}),"\n",(0,r.jsx)(t.h3,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(t.p,{children:["There is a config of flow control in ",(0,r.jsx)(t.a,{href:"https://github.com/mosn/layotto/blob/main/configs/runtime_config.json",children:"runtime_config.json"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'[\n    {\n        "type": "flowControlFilter",\n        "config": {\n            "global_switch": true,\n            "limit_key_type": "PATH",\n            "rules": [\n                {\n                    "resource": "/spec.proto.runtime.v1.Runtime/SayHello",\n                    "grade": 1,\n                    "threshold": 5\n                }\n            ]\n        }\n    }\n]\n'})}),"\n",(0,r.jsxs)(t.p,{children:["this can help ",(0,r.jsx)(t.code,{children:"/spec.proto.runtime.v1.Runtime/SayHello"})," method has a flow control feature, which means we can only access this method below 5 times in 1 second."]}),"\n",(0,r.jsxs)(t.p,{children:["this code of the client is here ",(0,r.jsx)(t.a,{href:"https://github.com/mosn/layotto/blob/main/demo/flowcontrol/client.go",children:"client.go"}),"\uff0cthe logic is very simple, send 10 times request to the server\uff0cand the result is below:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img.png",src:n(5925).A+"",width:"854",height:"291"})}),"\n",(0,r.jsx)(t.p,{children:"the previous 5 times request access is succeed while the last 5 times request is under control."}),"\n",(0,r.jsx)(t.h3,{id:"configuration-description",children:"Configuration Description"}),"\n",(0,r.jsx)(t.p,{children:"config:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"field_name"}),(0,r.jsx)(t.th,{children:"field_type"}),(0,r.jsx)(t.th,{children:"desc"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"global_switch"}),(0,r.jsx)(t.td,{children:"boolean"}),(0,r.jsx)(t.td,{children:"switch of this feature, true is open, false is close"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"limit_key_type"}),(0,r.jsx)(t.td,{children:"String"}),(0,r.jsxs)(t.td,{children:["Unique identifier\uff0cCurrently a fixed value ",(0,r.jsx)(t.code,{children:"PATH"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"rules"}),(0,r.jsx)(t.td,{children:"Array"}),(0,r.jsx)(t.td,{children:"rules of flow control"})]})]})]}),"\n",(0,r.jsx)(t.p,{children:"rules of flow control:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"field_name"}),(0,r.jsx)(t.th,{children:"field_type"}),(0,r.jsx)(t.th,{children:"desc"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resource"}),(0,r.jsx)(t.td,{children:"String"}),(0,r.jsx)(t.td,{children:"limit resource identification\uff0chere is the method URL"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"grade"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsxs)(t.td,{children:["Threshold update cycle\uff0cunit",":second"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"threshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:"be limited if exceed this threshold"})]})]})]})]})}function a(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},5925:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/flow_control-20f98067072359eea810f1f152f8120f.png"},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>l});var r=n(6540);const o={},s=r.createContext(o);function i(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);
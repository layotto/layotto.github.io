<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-design/sequencer/design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Sequencer API design document | Layotto</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://layotto.github.io/layotto/en-US/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://layotto.github.io/layotto/en-US/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://layotto.github.io/layotto/en-US/docs/design/sequencer/design"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en-US"><meta data-rh="true" name="docsearch:language" content="en-US"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Sequencer API design document | Layotto"><meta data-rh="true" name="description" content="This document discusses the API &quot;Generate Distributed Unique (auto-ad) id&quot;"><meta data-rh="true" property="og:description" content="This document discusses the API &quot;Generate Distributed Unique (auto-ad) id&quot;"><link data-rh="true" rel="icon" href="https://gw.alipayobjects.com/zos/bmw-prod/65518bfc-8ba5-4234-a5c5-2bc065e3a5f0.svg"><link data-rh="true" rel="canonical" href="https://layotto.github.io/layotto/en-US/docs/design/sequencer/design"><link data-rh="true" rel="alternate" href="https://layotto.github.io/layotto/en-US/docs/design/sequencer/design" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://layotto.github.io/layotto/docs/design/sequencer/design" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://layotto.github.io/layotto/docs/design/sequencer/design" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B0I4Q5CLN8-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/layotto/en-US/blog/rss.xml" title="Layotto RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/layotto/en-US/blog/atom.xml" title="Layotto Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Layotto" href="/layotto/en-US/opensearch.xml"><link rel="stylesheet" href="/layotto/en-US/assets/css/styles.a91448ad.css">
<script src="/layotto/en-US/assets/js/runtime~main.6bf77d4c.js" defer="defer"></script>
<script src="/layotto/en-US/assets/js/main.6c22ea4e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/layotto/en-US/"><div class="navbar__logo"><img src="https://gw.alipayobjects.com/zos/bmw-prod/65518bfc-8ba5-4234-a5c5-2bc065e3a5f0.svg" alt="Layotto Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://gw.alipayobjects.com/zos/bmw-prod/65518bfc-8ba5-4234-a5c5-2bc065e3a5f0.svg" alt="Layotto Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Layotto</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/layotto/en-US/docs/">Docs</a><a class="navbar__item navbar__link" href="/layotto/en-US/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/layotto/en-US/docs/design/sequencer/design"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/layotto/en-US/docs/design/sequencer/design" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/layotto/docs/design/sequencer/design" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/mosn/layotto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/layotto/en-US/docs/">Home Page</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/layotto/en-US/docs/start/">Quick Start</a><button aria-label="展开侧边栏分类 &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/layotto/en-US/docs/start/lab">Online Lab</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/building_blocks/file/">User Manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/configuration/overview">Operations Manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/layotto/en-US/docs/design/lifecycle/apply_configuration">Design Doc</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/lifecycle/apply_configuration">Dynamically configure the sending, component heated reload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/actuator/actuator-design-doc">Actuator Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/actuator/grpc-design-doc">MOSN gRPC framework design document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/configuration/configuration-api-with-apollo">Implementing Configuration API with ctripcorp/apollo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/pubsub/pubsub-api-and-compability-with-dapr-component">Layotto Pub/Sub, Compatible Dapr Package Scheme</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/rpc/rpc_design_document">RPC Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/lock/lock-api-design">Add TryLock and Unlock API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/layotto/en-US/docs/design/sequencer/design">Sequencer API design document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/file/file-design">File API design documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/faas/faas-poc-design">FaaS Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/api_plugin/design">API Plugin Design Documentation &amp; Use Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/api_plugin/dapr_api">dapr_api</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/oss/design">Layotto object storage (OSS) and collection of API interface definitions and design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/pluggable/design">Pluggable Component Design Document</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/development/CONTRIBUTING">Contribute Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/community/meeting">Community</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/layotto/en-US/docs/video/">Video collection</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home Page" class="breadcrumbs__link" href="/layotto/en-US/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Design Doc</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Sequencer API design document</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Overview</button></div><div class="theme-doc-markdown markdown"><h1>Sequencer API design document</h1>
<p>This document discusses the API &quot;Generate Distributed Unique (auto-ad) id&quot;</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" aria-label="Requirements的直接链接" title="Requirements的直接链接" href="/layotto/en-US/docs/design/sequencer/design#requirements">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generating-global-unique-id">Generating global unique id<a class="hash-link" aria-label="Generating global unique id的直接链接" title="Generating global unique id的直接链接" href="/layotto/en-US/docs/design/sequencer/design#generating-global-unique-id">​</a></h3>
<p>Q: When does a global unique id be generated?</p>
<p>A: db does not help you automatically generate it.Like：</p>
<ul>
<li>db has a split table that does not help you create id automatically, you need a global unique business id</li>
<li>No db, like request to generate a traceId</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="there-is-an-incremental-need-for-this-idmore-specifically-there-are-various">There is an incremental need for this id.More specifically there are various：<a class="hash-link" aria-label="There is an incremental need for this id.More specifically there are various：的直接链接" title="There is an incremental need for this id.More specifically there are various：的直接链接" href="/layotto/en-US/docs/design/sequencer/design#there-is-an-incremental-need-for-this-idmore-specifically-there-are-various">​</a></h3>
<ul>
<li>No increment required.This situation can be resolved by UUID, although the disadvantage is lengthy.<strong>This API does not consider this for the time</strong></li>
<li>“Growing trends”.Without a certain increase, most of the cases are on the increase.</li>
</ul>
<p>Q: What scenarios require trend incremental?</p>
<ol>
<li>
<p>For b+ tree db (e.g. MYSQL), the incremental main key can make better use of the cache (cache friendly).</p>
</li>
<li>
<p>Sort the most recent data.For example, needs are up to 100 news. Developers do not want to add timestamp fields or indexes. If the id itself is incremental, the latest 100 messages are sorted by id and sorted directly to：</p>
</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Select * from message order by message-id limit 100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is common when using nosql, because nosql has difficulty indexing the timestamp field</p>
<ul>
<li>
<p>Increase in lone transfer in sharding.e.g.<a href="https://docs.pingcap.com/zh/tidb/stable/auto-increment" target="_blank" rel="noopener noreferrer">Tidb的自增id</a> ensures the ID increment generated on a single server and does not guarantee a global (multi-servers) one-tone.</p>
</li>
<li>
<p>Global monochrome</p>
</li>
</ul>
<p>The desired id is necessarily incremental, and there is no regression.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="there-may-be-a-need-for-custom-id-schema">There may be a need for custom id schema<a class="hash-link" aria-label="There may be a need for custom id schema的直接链接" title="There may be a need for custom id schema的直接链接" href="/layotto/en-US/docs/design/sequencer/design#there-may-be-a-need-for-custom-id-schema">​</a></h3>
<p>For example, the required id is in the format &quot;Uid first 8 and auto-id&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="possible-information-security-related-requirements">Possible information security related requirements<a class="hash-link" aria-label="Possible information security related requirements的直接链接" title="Possible information security related requirements的直接链接" href="/layotto/en-US/docs/design/sequencer/design#possible-information-security-related-requirements">​</a></h3>
<p>If the ID is continuous, the pick-ups of malicious users will be very easy and the specified URL will be downloaded directly in order;</p>
<p>If an order number is more dangerous, competing for a direct knowledge of the user&#x27;s volume of one day.So in some application scenarios, IDs are unruly and unruly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="product-research">Product research<a class="hash-link" aria-label="Product research的直接链接" title="Product research的直接链接" href="/layotto/en-US/docs/design/sequencer/design#product-research">​</a></h2>
<table><thead><tr><th><strong>System</strong></th><th><strong>Securing the generated id unique</strong></th><th><strong>Trends</strong></th><th><strong>Strict increment</strong></th><th><strong>Availability</strong></th><th><strong>Information Security</strong></th></tr></thead><tbody><tr><td>Solo Redis</td><td>yes.<a href="https://redis.io/topics/persistence" target="_blank" rel="noopener noreferrer">Special configuration needs to be configured to redis, open and write disks for each of the two disk policies</a> to avoid data loss</td><td>yes</td><td>yes.premised on delay restarting without data</td><td>has single point failure risk</td><td></td></tr><tr><td>redis main copy from +sentinel</td><td>no.Copy is asynchronous, that is, waiting for sync copy using Wait command or may drop data after fo, see<a href="https://redis.io/topics/reapplication" target="_blank" rel="noopener noreferrer">文档</a></td><td>yes</td><td>Depending on which data will not be lost</td><td></td><td></td></tr><tr><td>redis cluster</td><td>Id.</td><td>yes</td><td>Id.</td><td></td><td></td></tr><tr><td>snowflake</td><td>no.(Clock callbacks, etc, can cause idrepeat; need to rely on external storage; or declare that NTP must be closed or reliable NTP used to prevent callbacks)</td><td>yes</td><td>No</td><td></td><td>Good</td></tr><tr><td>Leaf snowflake</td><td>yes</td><td>yes</td><td>No</td><td></td><td>Good</td></tr><tr><td>Leaf segment</td><td>yes</td><td>yes</td><td>No</td><td></td><td></td></tr><tr><td>Leaf segment only one Leaf server</td><td>yes</td><td>yes</td><td>yes</td><td>has single point failure risk</td><td></td></tr><tr><td>zookeeper</td><td>yes</td><td>yes</td><td>yes</td><td></td><td></td></tr><tr><td>etcd</td><td>yes</td><td>yes</td><td>yes</td><td></td><td></td></tr><tr><td>mysql Single Library Table</td><td>yes</td><td>yes</td><td>yes</td><td>has single point failure risk</td><td></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-grpc-api-design">3. grpc API design<a class="hash-link" aria-label="3. grpc API design的直接链接" title="3. grpc API design的直接链接" href="/layotto/en-US/docs/design/sequencer/design#3-grpc-api-design">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proto-definition">Proto definition<a class="hash-link" aria-label="Proto definition的直接链接" title="Proto definition的直接链接" href="/layotto/en-US/docs/design/sequencer/design#proto-definition">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Sequencer API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpc GetNextIdd (GetNextIdReques) returnns (GetNextIdResponse) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetNextIdest Lum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string store_name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /key is the identification of a consequence.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string key = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Sequencer options = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The metadata which will be sent to the component.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; metadata = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Sequencer Options requirements for increased and unproductive guarantees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Sequencer Options Fact  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum AutoAddition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // WEAK meaning a &quot;best forest&quot; increasing service. t there is no strict guarantee   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WAK = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // STRONG means a strict guarantee of global monotonically increasing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STRONG = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// enum Uniqueness$6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// / WEAK means a &quot;best ffort&quot; unqueness guarantee.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// But it might duplicate in some corner cases.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// WEAK = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// STRONG means a strict guarantee of global unity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// STRONG = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AutoIncreasing revenue = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Uniqueness union=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetNextIdResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 next_id=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Explanation：</p>
<p>In fact, a GetNextId interface requires a key to be passed as a namespace (e.g. an order form name, &quot;order_table&quot;), and a sequencer ensures that the id generated is unique and incremental in that naming space.</p>
<p>SequencerOptions. AutoCreation is used to state user demand for incremental increments, whether trend increase (WEAK) or strict global increment (STRONG)</p>
<p><strong>Q: Do you want to spell the user as needed?</strong></p>
<p>A: The API and Layotto run regardless of this, are handled by the sdk or the user themselves, or a special component can do the feature.</p>
<p><strong>Q: Return type string or int64</strong></p>
<p>If you return string, if a user uses a return int64 implementation to convert the returned string into int64 in the user&#x27;s code, then migrate to another component, this conversion may be misreported</p>
<p>If you return int64, the component does not help the user to make some customized spelling.</p>
<p>Select int64 for portability.Do things spelling in sdk</p>
<p><strong>Q: What to do with the int64 spill?</strong></p>
<p>Do not consider this for now</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disputes-concerning-singularity">Disputes concerning singularity<a class="hash-link" aria-label="Disputes concerning singularity的直接链接" title="Disputes concerning singularity的直接链接" href="/layotto/en-US/docs/design/sequencer/design#disputes-concerning-singularity">​</a></h3>
<p>The API was originally defined as the user sender&#x27;s SequencerOptions. Uniqueness enumeration, in which the WEAK representative is &quot;trying to ensure global uniqueness, but the very low probability is likely to be repeat&quot;, requires business code to be prepared for repeating and retrying if you get an id to write the library; and STRONG&#x27;s representatives are strictly global and the user code does not take into account the need for repetition, retry.</p>
<ul>
<li>Defines the reason for this enumeration value (benefits)</li>
</ul>
<p>If strict uniqueness is to be assured, the component will be more productive.For example, a one-stop cron policy will not work and may cause data to be lost and a repeat id to be generated when the machine is restarted; for example, writing a snowflake algorithm directly in the sidecar will not work because there may be a clock-back problem that leads to duplicate calls (NTP clock-synchronization, leap seconds, etc.).<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html" target="_blank" rel="noopener noreferrer">Leaf的snowflake实现</a> relies on zookeper&#x27;s callback to the clock;</p>
<ul>
<li>Define the disadvantage of this enumeration</li>
</ul>
<p>More understanding costs for users</p>
<ul>
<li>Conclusion</li>
</ul>
<p>There is a controversy. No value is added for this period.The result of the default return must be a global unique (STRONG).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="component-api">Component API<a class="hash-link" aria-label="Component API的直接链接" title="Component API的直接链接" href="/layotto/en-US/docs/design/sequencer/design#component-api">​</a></h2>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> sequencer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Store </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Init this component.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// The number &#x27;BiggerThan&#x27; means that the id generated by this component must be bigger than this number.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// If the component find that currently the storage can&#x27;t guarantee this,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// it can do some initialization like inserting a new id equal to or bigger than this &#x27;BiggerThan&#x27; into the storage,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// or just return an error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">Init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config Configuration</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">GetNextId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">GetNextIdRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">GetNextIdResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// GetSegment returns a range of id.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// &#x27;support&#x27; indicates whether this method is supported by the component.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">// Layotto runtime will cache the result if this method is supported.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">GetSegment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">GetSegmentRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">support </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">GetSegmentResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> GetNextIdRequest </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Key      </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Options  SequencerOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Metadata </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> SequencerOptions </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	AutoIncrement AutoIncrementOption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> AutoIncrementOption </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	WEAK   AutoIncrementOption </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;weak&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	STRONG AutoIncrementOption </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;strong&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> GetNextIdResponse </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	NextId </span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> GetSegmentRequest </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Size     </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Key      </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Options  SequencerOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Metadata </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> GetSegmentResponse </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Segment </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Configuration </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	BiggerThan </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Properties </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Q: What is the BiggerThan&#x27;s field?</strong></p>
<p>All IDs that require components to generate are larger than &quot;biggerThan&quot;.</p>
<p>This configuration item is designed to facilitate transplantation by users.For example, the system originally used mysql for hairdressing, id has been generated to 1000 and later migrated to PostgreSQL, and BiggerThan needs to be configured for 1000 so that the PostgreSQL components will be set up at initialization, force id above 1000 or report errors when the id is not found to meet the requirements and direct start.</p>
<p><strong>Q: What BiggerThan is a map?</strong></p>
<p>Because each key may have its own biggerThan.</p>
<p>For example, the original app1 made a split table, used some kind of distribution service to generate orders and commodity table ids, which reached 1000 and reached 2000.</p>
<p>The app1 then wants to replace the store as a sequence, then he would like to state that the order form id is over 1,000 and the product table id is above 2000.</p>
<p>Another example is<a href="https://tech.meituan.com/2017/04/21/mt-leaf.htm" target="_blank" rel="noopener noreferrer">Leaf的设计</a> and one max_id per biz_tag (Leaf&#x27;s max_id is our biggerThan)</p>
<p><img decoding="async" loading="lazy" alt="leaf_max_id.png" src="/layotto/en-US/assets/images/leaf_max_id-e39c29408a24d99885d5534759942654.png" width="2434" height="1442" class="img_ev3q"></p>
<p><strong>Q: Do not cache at runtime layer?</strong></p>
<p>Component implementation method： if runtime is cached</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GetSegment </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">GetSegmentRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">support </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">GetSegmentResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can define interfaces first, components are not implemented first, and there is performance need to implement them later</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" aria-label="References的直接链接" title="References的直接链接" href="/layotto/en-US/docs/design/sequencer/design#references">​</a></h2>
<p><a href="https://www.jianshu.com/p/fb9478687e55" target="_blank" rel="noopener noreferrer">设计分布式唯一id生成</a></p>
<p><a href="https://www.w3cschool.cn/architectroad/architectroad-distributed-id.html" target="_blank" rel="noopener noreferrer">Architectural Chat ID generation</a></p>
<p>[Leaf - USG point ID generation system] (<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/2017/04/21/mt-leaf.html</a>)</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mosn/layotto/edit/main/docs/i18n/en-US/docusaurus-plugin-content-docs/current/design/sequencer/design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/layotto/en-US/docs/design/lock/lock-api-design"><div class="pagination-nav__sublabel">pre page</div><div class="pagination-nav__label">Add TryLock and Unlock API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/layotto/en-US/docs/design/file/file-design"><div class="pagination-nav__sublabel">next page</div><div class="pagination-nav__label">File API design documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#requirements">Requirements</a><ul><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#generating-global-unique-id">Generating global unique id</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#there-is-an-incremental-need-for-this-idmore-specifically-there-are-various">There is an incremental need for this id.More specifically there are various：</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#there-may-be-a-need-for-custom-id-schema">There may be a need for custom id schema</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#possible-information-security-related-requirements">Possible information security related requirements</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#product-research">Product research</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#3-grpc-api-design">3. grpc API design</a><ul><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#proto-definition">Proto definition</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#disputes-concerning-singularity">Disputes concerning singularity</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#component-api">Component API</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/sequencer/design#references">References</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>
<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-design/lock/lock-api-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Add TryLock and Unlock API | Layotto</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://layotto.github.io/layotto/en-US/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://layotto.github.io/layotto/en-US/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://layotto.github.io/layotto/en-US/docs/design/lock/lock-api-design"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en-US"><meta data-rh="true" name="docsearch:language" content="en-US"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Add TryLock and Unlock API | Layotto"><meta data-rh="true" name="description" content="Add TryLock and Unlock API."><meta data-rh="true" property="og:description" content="Add TryLock and Unlock API."><link data-rh="true" rel="icon" href="https://gw.alipayobjects.com/zos/bmw-prod/65518bfc-8ba5-4234-a5c5-2bc065e3a5f0.svg"><link data-rh="true" rel="canonical" href="https://layotto.github.io/layotto/en-US/docs/design/lock/lock-api-design"><link data-rh="true" rel="alternate" href="https://layotto.github.io/layotto/en-US/docs/design/lock/lock-api-design" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://layotto.github.io/layotto/docs/design/lock/lock-api-design" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://layotto.github.io/layotto/docs/design/lock/lock-api-design" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B0I4Q5CLN8-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/layotto/en-US/blog/rss.xml" title="Layotto RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/layotto/en-US/blog/atom.xml" title="Layotto Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Layotto" href="/layotto/en-US/opensearch.xml"><link rel="stylesheet" href="/layotto/en-US/assets/css/styles.a91448ad.css">
<script src="/layotto/en-US/assets/js/runtime~main.93f5a0e6.js" defer="defer"></script>
<script src="/layotto/en-US/assets/js/main.6c22ea4e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/layotto/en-US/"><div class="navbar__logo"><img src="https://gw.alipayobjects.com/zos/bmw-prod/65518bfc-8ba5-4234-a5c5-2bc065e3a5f0.svg" alt="Layotto Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://gw.alipayobjects.com/zos/bmw-prod/65518bfc-8ba5-4234-a5c5-2bc065e3a5f0.svg" alt="Layotto Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Layotto</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/layotto/en-US/docs/">Docs</a><a class="navbar__item navbar__link" href="/layotto/en-US/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/layotto/en-US/docs/design/lock/lock-api-design"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/layotto/en-US/docs/design/lock/lock-api-design" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/layotto/docs/design/lock/lock-api-design" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/mosn/layotto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/layotto/en-US/docs/">Home Page</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/layotto/en-US/docs/start/">Quick Start</a><button aria-label="展开侧边栏分类 &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/layotto/en-US/docs/start/lab">Online Lab</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/building_blocks/file/">User Manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/configuration/overview">Operations Manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/layotto/en-US/docs/design/lifecycle/apply_configuration">Design Doc</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/lifecycle/apply_configuration">Dynamically configure the sending, component heated reload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/actuator/actuator-design-doc">Actuator Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/actuator/grpc-design-doc">MOSN gRPC framework design document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/configuration/configuration-api-with-apollo">Implementing Configuration API with ctripcorp/apollo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/pubsub/pubsub-api-and-compability-with-dapr-component">Layotto Pub/Sub, Compatible Dapr Package Scheme</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/rpc/rpc_design_document">RPC Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/layotto/en-US/docs/design/lock/lock-api-design">Add TryLock and Unlock API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/sequencer/design">Sequencer API design document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/file/file-design">File API design documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/faas/faas-poc-design">FaaS Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/api_plugin/design">API Plugin Design Documentation &amp; Use Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/api_plugin/dapr_api">dapr_api</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/oss/design">Layotto object storage (OSS) and collection of API interface definitions and design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/layotto/en-US/docs/design/pluggable/design">Pluggable Component Design Document</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/development/CONTRIBUTING">Contribute Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/layotto/en-US/docs/community/meeting">Community</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/layotto/en-US/docs/video/">Video collection</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home Page" class="breadcrumbs__link" href="/layotto/en-US/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Design Doc</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Add TryLock and Unlock API</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Overview</button></div><div class="theme-doc-markdown markdown"><h1>Add TryLock and Unlock API</h1>
<p>Add TryLock and Unlock API.</p>
<p>The renewal API is disputed and version 1 is not part of the renewal API</p>
<h1>Research</h1>
<table><thead><tr><th><strong>System</strong></th><th><strong>Distributed Lock</strong></th><th><strong>Block lock (watch)</strong></th><th><strong>Availability</strong></th><th><strong>Write line consistent</strong></th><th><strong>sequencer (<a href="https://static.googleusercontent.com/media/research.google.com/zh-TW//archive/chubby-osdi06.pdf" target="_blank" rel="noopener noreferrer">chubby论文里提出的feature</a></strong></th><th><strong>Renewed</strong></th></tr></thead><tbody><tr><td>Solo Redis</td><td>yes</td><td>x</td><td>Lock service is not available when single point expires</td><td>yes</td><td>yes(needed pic)</td><td>yes</td></tr><tr><td>rediscluster</td><td>yes</td><td>x</td><td>yes</td><td>no. Failures can cause locking</td><td>yes(needed pic)</td><td>yes</td></tr><tr><td>redis Redlock</td><td>yes</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>consul</td><td>yes</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>zookeeper</td><td>yes</td><td>yes</td><td>yes has fo, [elections within 200 ms] (<a href="https://pdos.csail.mit.edu/6.824/papers/zookeeper.pdf" target="_blank" rel="noopener noreferrer">https://pdos.csail.mit.edu/6.824/papers/zookeeper.pdf</a>)</td><td>yes</td><td>yes use zxid as sensor</td><td>yes</td></tr><tr><td>etcd</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes use revision</td><td>yes lease. KeepAlive</td></tr></tbody></table>
<p>Can see some difference in capacity or</p>
<h1>High-level design</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a class="hash-link" aria-label="API的直接链接" title="API的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#api">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-principles">Design principles<a class="hash-link" aria-label="Design principles的直接链接" title="Design principles的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#design-principles">​</a></h3>
<p>We are faced with many temptations, distributive locks have many features that can be done (blocked, relocked, read, lock, sequencer, etc.)</p>
<p>But after all, our goal is to design a sufficient set of common API specifications, so as to be as conservative as possible on the API, to abstract simple and common features into API specifications before considering more features into API norms</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trylockunlock">TryLock/Unlock<a class="hash-link" aria-label="TryLock/Unlock的直接链接" title="TryLock/Unlock的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#trylockunlock">​</a></h3>
<p>Base Lockout and unlock features.TryLock is not blocked, return directly if no locks are grabbed</p>
<p>proto:</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Distributed Lock API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpc TryLock(TryLockRequest)returns (TryLockResponse) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpc Unlock(UnlockRequest)returns (UnlockResponse) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TryLockRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string store_name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // resource_id is the lock key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string resource_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // lock_owner indicate the identifier of lock owner.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This field is required.You can generate a uuid as lock_owner.For example,in golang:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // req.LockOwner = uuid.New().String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This field is per request,not per process,so it is different for each request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // which aims to prevent multi-thread in the same process trying the same lock concurrently.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The reason why we don&#x27;t make it automatically generated is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 1. If it is automatically generated,there must be a &#x27;my_lock_owner_id&#x27; field in the response.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This name is so weird that we think it is inappropriate to put it into the api spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 2. If we change the field &#x27;my_lock_owner_id&#x27; in the response to &#x27;lock_owner&#x27;,which means the current lock owner of this lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // we find that in some lock services users can&#x27;t get the current lock owner.Actually users don&#x27;t need it at all.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 3. When reentrant lock is needed,the existing lock_owner is required to identify client and check &quot;whether this client can reenter this lock&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // So this field in the request shouldn&#x27;t be removed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string lock_owner = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // expire is the time before expire.The time unit is second.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 expire = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TryLockResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool success = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message UnlockRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string store_name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // resource_id is the lock key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string resource_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string lock_owner = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message UnlockResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum Status {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SUCCESS = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOCK_UNEXIST = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOCK_BELONG_TO_OTHERS = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INTERNAL_ERROR = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Status status = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Q: the time unit for the expire?</strong></p>
<p>A: seconds.</p>
<p><strong>Q: Can you force users to make seconds large points without being too small?</strong></p>
<p>A: is not allowed on compilation or on startup.</p>
<p><strong>Q: What if multiple clients transmit the same LockOwner?</strong></p>
<p>Case 1. Two client app-id is different, with the same lockOwner passed and no conflict</p>
<p>Case 2. Like the two client app-ids, there is a conflict between LockOwner with the same passage.There may be exceptional circumstances in which someone can be robbed, frees someone else&#x27;s lock.</p>
<p>The user therefore needs to ensure the uniqueness of LockOwner, such as assigning a UUID, golangprototype： per request</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;github.com/google/uuid&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LockOwner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Q: What does not meta</strong></p>
<p>A: Be as conservative as possible at the beginning, and some people get feedback about additional needs or find out in the implementation of the component that there is a real need for settlement</p>
<p><strong>Q: Do you want to support sequentier and relocking features like then?</strong></p>
<p>A: Add feature option to add components to support interface</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="renewal">Renewal<a class="hash-link" aria-label="Renewal的直接链接" title="Renewal的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#renewal">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="solvation-a-add-an-api-lockkeepalive">Solvation A: add an API &quot;LockKeepAlive&quot;<a class="hash-link" aria-label="Solvation A: add an API &quot;LockKeepAlive&quot;的直接链接" title="Solvation A: add an API &quot;LockKeepAlive&quot;的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#solvation-a-add-an-api-lockkeepalive">​</a></h4>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rpc LockKeepAlive(stream LockKeepAliveRequest) returns (stream LockKeepAliveResponse) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message LockKeepAliveRequest L$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // resource_id is the lock key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string resource_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string client_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // expire is the time to expire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 expire = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message LockKeepAliveResponse LO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum Status Fit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SUCCESS = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOCK_UNEXIST = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOCK_BELONG_TO_OTHERS = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // resource_id is the lock key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string resource_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Status status = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The re-entry of the lease and the return result is stream, where the implementation of the reference etcd, the app and sidecar need to maintain only one connection and use the link to relay the renewal lease request every time the lock requires a renewal lease.</p>
<p><strong>Q: Why don&#x27;t you use the renewal as a stream parameter to tryLock?</strong></p>
<p>A: Many businesses are not rented to make trylock as simple as possible;</p>
<p>To maximize single responsibilities, followed by blocklocks that can be used to renew the API;</p>
<p>Split parts with streams into an interface to make it easy for https.</p>
<p><strong>Q: The renewal logic is too complex to make users unknown?</strong></p>
<p>A: sdk block this logic, start thread/protocol/nodejs timing, automatic renewal</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="solvolution-b-users-are-not-aware-of-continued-lease-logic-auto-rent-app-and-sidecar-maintain-a-unified-heart-jump">Solvolution B: Users are not aware of continued lease logic, auto-rent, app and sidecar maintain a unified heart jump<a class="hash-link" aria-label="Solvolution B: Users are not aware of continued lease logic, auto-rent, app and sidecar maintain a unified heart jump的直接链接" title="Solvolution B: Users are not aware of continued lease logic, auto-rent, app and sidecar maintain a unified heart jump的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#solvolution-b-users-are-not-aware-of-continued-lease-logic-auto-rent-app-and-sidecar-maintain-a-unified-heart-jump">​</a></h4>
<p>Disadvantages/Difficulty：</p>
<ol>
<li>Use uniform heart jumps, it is difficult to customize interval</li>
</ol>
<p>Solve is a guaranteed low jump intervals, for example 1 second time in 1 second</p>
<ol start="2">
<li>How to ensure reliable troubleshooting?</li>
</ol>
<p>e.g. the java code below, unlock may fail：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tryLO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}finallyLO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lock.unlock()   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If a single machine lock, unlock guarantees success (unless the entire jvm failure), but unlocks can fail.How can you make sure to jump off when the call fails?</p>
<p>This requires business to jump to the state of some fine particle levels when developing the business.</p>
<p>We can define the HTML callback interface to be detected by actuator wheel and agree that the callback returned data structure is：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;UP&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;details&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;lock&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;resource_id&quot;: &quot;res1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;client_id&quot;: &quot;dasfdasfasdfa&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;unlock_fail&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;xxx&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>App handles state gathering, reporting and clearing after successful reporting, limiting map capacity (e.g. the number of failed reports and the size of the map&#x27;s big OOOM). Altogether, it requires the app to perform some complicated logic, as well as to release the sdk</p>
<ol start="3">
<li>This implementation, like renewal of rent, is managed on a separate connection that needs to be reported through this public connection.</li>
<li>API speciality dependency jump logic.Dependency jumps interval and heart jump back data structure.The equivalent of the API speck relies on Layotto implementation, unless we can also standardize heart jump and drop (including intervals, returned data structures, etc.)</li>
<li>Heart jump failed once. Do sidecar continue rent?If the sidecar stopped renting anymore, will the next heart jump test be normal, will sidecar resume the lease?It is more difficult to define, because there is a skeptical mechanism (for example, a few failures of heart failure), when the skepticism ends too slowly and when the radical stop of the lease can be repeated</li>
<li>The app skipped once and then restored. sidecar knows how to know if the app continues to be locked (it may be just a short time to shake, then restored, or it may simply restart unlocked)</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="solvation-c-retries-unlock">Solvation C<!-- -->:app<!-- --> retries unlock<a class="hash-link" aria-label="solvation-c-retries-unlock的直接链接" title="solvation-c-retries-unlock的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#solvation-c-retries-unlock">​</a></h4>
<p>If unlocks fail, apply your own asynchronous retry unlock</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" aria-label="Conclusion的直接链接" title="Conclusion的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#conclusion">​</a></h4>
<p>There are currently divergent views on the renewal of the rental scheme and the renewal of the rental function will not be achieved in one issue.</p>
<p>Personal inclination to Program A, sdk blocks the logic of renewal of rent.While a grpc direct transfer would require the processing of the renewal logic, the renewal of the lease would be a distributed localized locking programme and a low cost of understanding by the developers.</p>
<p>Throw out for everybody</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a class="hash-link" aria-label="Components的直接链接" title="Components的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#components">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-deal-with-components-do-not-support-a-feature-option">How to deal with &quot;components do not support a feature option&quot;<a class="hash-link" aria-label="How to deal with &quot;components do not support a feature option&quot;的直接链接" title="How to deal with &quot;components do not support a feature option&quot;的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#how-to-deal-with-components-do-not-support-a-feature-option">​</a></h3>
<p>Simulate &gt;Run Error&gt;ignore</p>
<p>Exceptional circumstances, such as consistence, are eventual, but the storage system itself is strong and can be used as an option</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-deal-with-components-do-not-support-an-api">How to deal with &quot;components do not support an API&quot;<a class="hash-link" aria-label="How to deal with &quot;components do not support an API&quot;的直接链接" title="How to deal with &quot;components do not support an API&quot;的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#how-to-deal-with-components-do-not-support-an-api">​</a></h3>
<p>Simulate &gt;Run Error</p>
<p>As transaction API examples</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="selection">Selection:<a class="hash-link" aria-label="Selection:的直接链接" title="Selection:的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#selection">​</a></h3>
<p>Select Single Machine Redisimplementation</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-missing-designs-destroy-portability-and-how-can-users-be-made-simpler-to-assess-whether-they-can-transplant">&quot;Running missing&quot; designs destroy portability and how can users be made simpler to assess whether they can transplant?<a class="hash-link" aria-label="&quot;Running missing&quot; designs destroy portability and how can users be made simpler to assess whether they can transplant?的直接链接" title="&quot;Running missing&quot; designs destroy portability and how can users be made simpler to assess whether they can transplant?的直接链接" href="/layotto/en-US/docs/design/lock/lock-api-design#running-missing-designs-destroy-portability-and-how-can-users-be-made-simpler-to-assess-whether-they-can-transplant">​</a></h3>
<p>Providing a document, where each component of the document gives a different guarantee, feature, allowing users to assess themselves</p>
<p>Declares the feature option supported by the API in the sidecar configuration. If sidecar starts to discover that the component is not match, report an error on startup</p>
<p>C. Residecar running time logs, automatic statistical data on what features the app uses and log analysis when transplant is required</p>
<p>D. Profiling first</p>
<p>E. Providing a static analysis tool for automatic transplantation analysis</p>
<p>Conclusion：Option A because it is simple</p>
<h1>Future work</h1>
<ul>
<li>Remindable</li>
</ul>
<p>There will be some arithmetic logic.You need to consider whether all locks can be reentered by default, or add a feature to the upload.</p>
<ul>
<li>Block Lock</li>
<li>sequencer</li>
</ul>
<h1>Reference</h1>
<p><a href="https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html" target="_blank" rel="noopener noreferrer">How to do distressed blocking</a></p>
<p><a href="https://static.googleusercontent.com/media/research.google.com/zh-TW//archive/chubby-osdi06.pdf" target="_blank" rel="noopener noreferrer">The Chubby lock service for loosely-coupled distributed systems</a></p>
<p><a href="https://www.jianshu.com/p/6e72eee5623" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/6e72e3eee5623</a></p>
<p><a href="http://zhangtielei.com/posts/blog-redlock-reasoning.html" target="_blank" rel="noopener noreferrer">http://zhangtielei.com/posts/blog-redlock-reasoning.html</a></p>
<p><a href="http://zhangtielei.com/posts/blog-redlock-reasoning-part2.html" target="_blank" rel="noopener noreferrer">http://zhangtielei.com/posts/blog-redlock-reasoning-part2.html</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mosn/layotto/edit/main/design/lock/lock-api-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/layotto/en-US/docs/design/rpc/rpc_design_document"><div class="pagination-nav__sublabel">pre page</div><div class="pagination-nav__label">RPC Design Document</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/layotto/en-US/docs/design/sequencer/design"><div class="pagination-nav__sublabel">next page</div><div class="pagination-nav__label">Sequencer API design document</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#api">API</a><ul><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#design-principles">Design principles</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#trylockunlock">TryLock/Unlock</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#renewal">Renewal</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#components">Components</a><ul><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#how-to-deal-with-components-do-not-support-a-feature-option">How to deal with &quot;components do not support a feature option&quot;</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#how-to-deal-with-components-do-not-support-an-api">How to deal with &quot;components do not support an API&quot;</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#selection">Selection:</a></li><li><a class="table-of-contents__link toc-highlight" href="/layotto/en-US/docs/design/lock/lock-api-design#running-missing-designs-destroy-portability-and-how-can-users-be-made-simpler-to-assess-whether-they-can-transplant">&quot;Running missing&quot; designs destroy portability and how can users be made simpler to assess whether they can transplant?</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>
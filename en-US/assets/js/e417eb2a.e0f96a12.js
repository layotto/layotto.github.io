"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[1118],{4730:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var n=o(4848),s=o(8453);const a={},r="Configuration API demo with Etcd",i={id:"start/configuration/start",title:"Configuration API demo with Etcd",description:"This example shows that when you are using etcd as a configuration center, how to add, delete, modify, and watch the etcd through Layotto.",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/start/configuration/start.md",sourceDirName:"start/configuration",slug:"/start/configuration/start",permalink:"/layotto/en-US/docs/start/configuration/start",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/start/configuration/start.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Configuration API demo with apollo",permalink:"/layotto/en-US/docs/start/configuration/start-apollo"},next:{title:"Configuration API demo with Nacos",permalink:"/layotto/en-US/docs/start/configuration/start-nacos"}},c={},d=[{value:"step 1. Deploy etcd and Layotto",id:"step-1-deploy-etcd-and-layotto",level:2},{value:"<strong>With Docker Compose</strong>",id:"with-docker-compose",level:3},{value:"<strong>Compile locally (not for Windows)</strong>",id:"compile-locally-not-for-windows",level:3},{value:"step 1.1 Start etcd",id:"step-11-start-etcd",level:3},{value:"step 1.2 Start Layotto",id:"step-12-start-layotto",level:3},{value:"step 2. Start client APP",id:"step-2-start-client-app",level:2},{value:"step 3. Stop containers and release resources",id:"step-3-stop-containers-and-release-resources",level:2},{value:"<strong>Docker Compose</strong>",id:"docker-compose",level:3},{value:"<strong>Destroy the etcd container</strong>",id:"destroy-the-etcd-container",level:3},{value:"Next step",id:"next-step",level:2},{value:"What did this demo do?",id:"what-did-this-demo-do",level:3},{value:"Let&#39;s continue to experience other APIs",id:"lets-continue-to-experience-other-apis",level:3}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"configuration-api-demo-with-etcd",children:"Configuration API demo with Etcd"}),"\n",(0,n.jsx)(t.p,{children:"This example shows that when you are using etcd as a configuration center, how to add, delete, modify, and watch the etcd through Layotto."}),"\n",(0,n.jsx)(t.p,{children:"The architecture of this demo is shown in the figure below. The processes started are: client APP, Layotto, etcd"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:"https://gw.alipayobjects.com/mdn/rms_5891a1/afts/img/A*dzGaSb78UCoAAAAAAAAAAAAAARQnAQ",alt:""})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/mosn/layotto/blob/main/configs/runtime_config.json",children:"Then config file"})," claims ",(0,n.jsx)(t.code,{children:"etcd"})," in the ",(0,n.jsx)(t.code,{children:"config_store"})," section, but users can change it to other configuration center they want (currently only support etcd and apollo)."]}),"\n",(0,n.jsx)(t.h2,{id:"step-1-deploy-etcd-and-layotto",children:"step 1. Deploy etcd and Layotto"}),"\n",(0,n.jsx)(t.h3,{id:"with-docker-compose",children:(0,n.jsx)(t.strong,{children:"With Docker Compose"})}),"\n",(0,n.jsx)(t.p,{children:"You can start etcd and Layotto with docker-compose"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"cd docker/layotto-etcd\n# Start etcd and layotto with docker-compose\ndocker-compose up -d\n"})}),"\n",(0,n.jsx)(t.h3,{id:"compile-locally-not-for-windows",children:(0,n.jsx)(t.strong,{children:"Compile locally (not for Windows)"})}),"\n",(0,n.jsx)(t.p,{children:"You can run etcd with Docker, then compile and run Layotto locally."}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"[!TIP|label: Not for Windows users]\nLayotto fails to compile under Windows. Windows users are recommended to deploy using docker-compose"}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"step-11-start-etcd",children:"step 1.1 Start etcd"}),"\n",(0,n.jsx)(t.p,{children:"If you want to run this demo, you need to start a etcd server first."}),"\n",(0,n.jsxs)(t.p,{children:["You can download etcd from ",(0,n.jsx)(t.code,{children:"https://github.com/etcd-io/etcd/releases"})," \uff08You can also use docker.\uff09"]}),"\n",(0,n.jsx)(t.p,{children:"start it:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",metastring:"@background",children:"./etcd\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Then you can access etcd with the address ",(0,n.jsx)(t.code,{children:"localhost:2379"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"step-12-start-layotto",children:"step 1.2 Start Layotto"}),"\n",(0,n.jsx)(t.p,{children:"Build Layotto:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"cd ${project_path}/cmd/layotto\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",metastring:"@if.not.exist layotto",children:"go build\n"})}),"\n",(0,n.jsx)(t.p,{children:"Run it:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",metastring:"@background",children:"./layotto start -c ../../configs/runtime_config.json\n"})}),"\n",(0,n.jsx)(t.h2,{id:"step-2-start-client-app",children:"step 2. Start client APP"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:" cd ${project_path}/demo/configuration/common\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",metastring:"@if.not.exist client",children:" go build -o client\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:' ./client -s "config_demo"\n'})}),"\n",(0,n.jsx)(t.p,{children:"If the following information is printed out, it means the client app has done all the CRUD operations successfully\uff1a"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'save key success\nget configuration after save, &{Key:key1 Content:value1 Group:application Label:prod Tags:map[feature:print release:1.0.0] Metadata:map[]} \nget configuration after save, &{Key:haha Content:heihei Group:application Label:prod Tags:map[feature:haha release:1.0.0] Metadata:map[]} \ndelete keys success\nwrite start\nreceive subscribe resp store_name:"config_demo" app_id:"apollo" items:<key:"heihei" content:"heihei1" group:"application" label:"prod" tags:<key:"feature" value:"haha" > tags:<key:"release" value:"16" > >\n'})}),"\n",(0,n.jsx)(t.h2,{id:"step-3-stop-containers-and-release-resources",children:"step 3. Stop containers and release resources"}),"\n",(0,n.jsx)(t.h3,{id:"docker-compose",children:(0,n.jsx)(t.strong,{children:"Docker Compose"})}),"\n",(0,n.jsx)(t.p,{children:"If you started etcd and Layotto with docker-compose, you can shut them down as follows:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"cd ${project_path}/docker/layotto-etcd\ndocker-compose stop\n"})}),"\n",(0,n.jsx)(t.h3,{id:"destroy-the-etcd-container",children:(0,n.jsx)(t.strong,{children:"Destroy the etcd container"})}),"\n",(0,n.jsx)(t.p,{children:"If you started etcd with Docker, you can destroy the etcd container as follows:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"docker rm -f etcd\n"})}),"\n",(0,n.jsx)(t.h2,{id:"next-step",children:"Next step"}),"\n",(0,n.jsx)(t.h3,{id:"what-did-this-demo-do",children:"What did this demo do?"}),"\n",(0,n.jsx)(t.p,{children:"The demo client uses the golang version SDK provided by Layotto, and invokes Layotto's Configuration API to add, delete, modify, and subscribe to configuration data."}),"\n",(0,n.jsxs)(t.p,{children:["The sdk is located in the ",(0,n.jsx)(t.code,{children:"sdk"})," directory. Users can invoke the Layotto API using the sdk."]}),"\n",(0,n.jsx)(t.p,{children:"In addition to using sdk, you can also interact with Layotto directly through grpc in any language you like."}),"\n",(0,n.jsx)(t.p,{children:"In fact, sdk is only a very thin package for grpc, using sdk is about equal to directly using grpc."}),"\n",(0,n.jsx)(t.h3,{id:"lets-continue-to-experience-other-apis",children:"Let's continue to experience other APIs"}),"\n",(0,n.jsx)(t.p,{children:"Explore other Quickstarts through the navigation bar on the left."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>i});var n=o(6540);const s={},a=n.createContext(s);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);
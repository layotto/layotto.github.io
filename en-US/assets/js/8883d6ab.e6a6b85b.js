"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[6499],{2968:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var n=o(4848),s=o(8453);const i={},r="Layotto sidecar injector",c={id:"operation/sidecar_injector",title:"Layotto sidecar injector",description:"Sidecar injector can inject the Layotto sidecar to your pods automatically.",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/operation/sidecar_injector.md",sourceDirName:"operation",slug:"/operation/sidecar_injector",permalink:"/layotto/en-US/docs/operation/sidecar_injector",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/operation/sidecar_injector.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"How to deploy and upgrade Layotto",permalink:"/layotto/en-US/docs/operation/"},next:{title:"How to Debugging Locally",permalink:"/layotto/en-US/docs/operation/local"}},l={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1 - Setup Layotto sidecar injector on your Kubernetes cluster",id:"step-1---setup-layotto-sidecar-injector-on-your-kubernetes-cluster",level:2},{value:"Step 2 - Use Helm to deploy Redis on your Kubernetes cluster",id:"step-2---use-helm-to-deploy-redis-on-your-kubernetes-cluster",level:2},{value:"Step 3 - Deploy the layotto state client with the Layotto sidecar",id:"step-3---deploy-the-layotto-state-client-with-the-layotto-sidecar",level:2},{value:"View program running results",id:"view-program-running-results",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"layotto-sidecar-injector",children:"Layotto sidecar injector"}),"\n",(0,n.jsx)(t.p,{children:"Sidecar injector can inject the Layotto sidecar to your pods automatically."}),"\n",(0,n.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsx)(t.p,{children:"This Layotto state SDK client demo requires you to have the following installed on your machine:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"kubectl"})}),"\n",(0,n.jsxs)(t.li,{children:["A Kubernetes cluster, such as ",(0,n.jsx)(t.a,{href:"https://minikube.sigs.k8s.io/docs/start/",children:"Minikube"}),", ",(0,n.jsx)(t.a,{href:"https://kind.sigs.k8s.io/docs/user/quick-start/",children:"Kind"})]}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://helm.sh/docs/intro/install/",children:"Helm v3"})}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Remember to change your current directory to ",(0,n.jsx)(t.code,{children:"${project_path}/demo/state/k8s"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"step-1---setup-layotto-sidecar-injector-on-your-kubernetes-cluster",children:"Step 1 - Setup Layotto sidecar injector on your Kubernetes cluster"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Use Kind to quickly build a local Kubernetes cluster"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"kind create cluster --name layotto-cluster\nkubectl config use-context kind-layotto-cluster\n"})}),"\n",(0,n.jsxs)(t.ol,{start:"2",children:["\n",(0,n.jsx)(t.li,{children:"Install the layotto sidecar injector chart on your cluster in the layotto-system namespace"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"helm install injector oci://docker.io/layotto/injector-helm --version v0.5.0 -n layotto-system --create-namespace --wait\n"})}),"\n",(0,n.jsx)(t.h2,{id:"step-2---use-helm-to-deploy-redis-on-your-kubernetes-cluster",children:"Step 2 - Use Helm to deploy Redis on your Kubernetes cluster"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"Redis"})," is an open source, advanced key-value store. It is often referred to as a data structure server since keys\ncan contain strings, hashes, lists, sets and sorted sets."]}),"\n",(0,n.jsxs)(t.p,{children:["Here we use ",(0,n.jsx)(t.code,{children:"Redis"})," to persist and retrieve state."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo update\nhelm install redis bitnami/redis --set image.tag=6.2 --set auth.enabled=false\n"})}),"\n",(0,n.jsx)(t.h2,{id:"step-3---deploy-the-layotto-state-client-with-the-layotto-sidecar",children:"Step 3 - Deploy the layotto state client with the Layotto sidecar"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Create a ConfigMap named ",(0,n.jsx)(t.code,{children:"layotto-config"})," and populate its data from the ",(0,n.jsx)(t.code,{children:"config.json"})," file"]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"kubectl create configmap layotto-config --from-file=./config.json\n"})}),"\n",(0,n.jsxs)(t.ol,{start:"2",children:["\n",(0,n.jsx)(t.li,{children:"Deploy Layotto state SDK client App"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"kubectl apply -f ./state-sdk-demo.yaml\n"})}),"\n",(0,n.jsx)(t.p,{children:"Let's take a look at the important annotations in state-sdk-demo.yaml"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:'layotto/sidecar-inject: "true"'})," - this tells the Layotto sidecar injector to inject a sidecar to this deployment."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:'layotto/config-volume: "layotto-config-vol'})," - this tells the Layotto sidecar injector which config Volume resource to\nmount into layout container."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"layotto-config"})," ConfigMap is mounted as a volume, and all contents stored in its ",(0,n.jsx)(t.code,{children:"config.json"})," entry are mounted into\nthe layotto sidecar container at path ",(0,n.jsx)(t.code,{children:"/runtime/configs"}),". The successfully mounted ",(0,n.jsx)(t.code,{children:"config.json"})," file will be used as the configuration\nfile when Layotto starts."]}),"\n",(0,n.jsx)(t.h2,{id:"view-program-running-results",children:"View program running results"}),"\n",(0,n.jsx)(t.p,{children:"If the following information is printed, the demo succeeded:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:"https://raw.githubusercontent.com/mosn/layotto/6e0fa2c49dde40ba9a3400f193ef35ff2c670754/demo/state/k8s/images/pods.jpg",alt:"pods.jpg"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:"https://raw.githubusercontent.com/mosn/layotto/6e0fa2c49dde40ba9a3400f193ef35ff2c670754/demo/state/k8s/images/log.jpg",alt:"log.jpg"})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>c});var n=o(6540);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);
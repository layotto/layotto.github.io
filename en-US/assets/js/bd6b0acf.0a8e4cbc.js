"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[1731],{9873:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>i});var n=t(4848),l=t(8453);const r={},d="Snowflake",o={id:"component_specs/sequencer/snowflake",title:"Snowflake",description:"metadata fields",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/component_specs/sequencer/snowflake.md",sourceDirName:"component_specs/sequencer",slug:"/component_specs/sequencer/snowflake",permalink:"/layotto/en-US/docs/component_specs/sequencer/snowflake",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/component_specs/sequencer/snowflake.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"mysql",permalink:"/layotto/en-US/docs/component_specs/sequencer/mysql"},next:{title:"Secret Store component",permalink:"/layotto/en-US/docs/component_specs/secret/common"}},c={},i=[{value:"metadata fields",id:"metadata-fields",level:2},{value:"Overall design",id:"overall-design",level:2},{value:"How to start mysql",id:"how-to-start-mysql",level:2},{value:"Run layotto",id:"run-layotto",level:2},{value:"Run Demo",id:"run-demo",level:2}];function a(e){const s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"snowflake",children:"Snowflake"}),"\n",(0,n.jsx)(s.h2,{id:"metadata-fields",children:"metadata fields"}),"\n",(0,n.jsx)(s.p,{children:"Example: configs/config_snowflake.json"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Required"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"mysqlHost"}),(0,n.jsx)(s.td,{children:"Y"}),(0,n.jsx)(s.td,{children:"mysql server address, such as localhost:3306"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"userName"}),(0,n.jsx)(s.td,{children:"Y"}),(0,n.jsx)(s.td,{children:"mysql username"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"password"}),(0,n.jsx)(s.td,{children:"Y"}),(0,n.jsx)(s.td,{children:"mysql password"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"databaseName"}),(0,n.jsx)(s.td,{children:"Y"}),(0,n.jsx)(s.td,{children:"mysql database name"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"tableName"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"mysql table name"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"timeBits"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"time id size,  default value is 28"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"workerBits"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"worker id size, default value is 22"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"seqBits"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"sequence id size, default value is 13"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"startTime"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"time base, default value is \u201c2022-01-01\u201d"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"reqTimeout"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"id request timeout. Default is 500 milliseconds"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"keyTimeout"}),(0,n.jsx)(s.td,{children:"N"}),(0,n.jsx)(s.td,{children:"timeout of key namespace. The default is 24 hours"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"overall-design",children:"Overall design"}),"\n",(0,n.jsx)(s.p,{children:"The overall design of the id generated by the snowflake algorithm is as follows:"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:"https://www.gitlink.org.cn/api/attachments/397699",alt:"img.jpg"})}),"\n",(0,n.jsx)(s.h2,{id:"how-to-start-mysql",children:"How to start mysql"}),"\n",(0,n.jsx)(s.p,{children:"If you want to run the mysql demo, you need to start a mysql server with Docker first."}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsx)(s.p,{children:"If port 3306 is occupied by other services, you need to exit other services first"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"docker pull mysql:latest\ndocker run --name snowflake -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql\ndocker exec -it snowflake bash\nmysql -uroot -p123456\n"})}),"\n",(0,n.jsx)(s.p,{children:"You need to create a new database:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-mysql",children:"CREATE DATABASE layotto_sequencer;\n"})}),"\n",(0,n.jsx)(s.h2,{id:"run-layotto",children:"Run layotto"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"cd ${project_path}/cmd/layotto\ngo build\n"})}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["If build reports an error, it can be executed in the root directory of the project ",(0,n.jsx)(s.code,{children:"go mod vendor"})]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Execute after the compilation is successful:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"./layotto start -c ../../configs/config_redis.json\n"})}),"\n",(0,n.jsx)(s.h2,{id:"run-demo",children:"Run Demo"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:'cd ${project_path}/demo/sequencer/redis/\n go build -o client\n ./client -s "sequencer_demo"\n'})})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>d,x:()=>o});var n=t(6540);const l={},r=n.createContext(l);function d(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);
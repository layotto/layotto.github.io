"use strict";(self.webpackChunklayotto_docusaurus=self.webpackChunklayotto_docusaurus||[]).push([[3072],{4226:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var n=t(4848),i=t(8453);const s={},r="How to deploy and upgrade Layotto",a={id:"operation/README",title:"How to deploy and upgrade Layotto",description:"1. Deploy Layotto",source:"@site/i18n/en-US/docusaurus-plugin-content-docs/current/operation/README.md",sourceDirName:"operation",slug:"/operation/",permalink:"/layotto/en-US/docs/operation/",draft:!1,unlisted:!1,editUrl:"https://github.com/mosn/layotto/edit/main/operation/README.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Custom Component",permalink:"/layotto/en-US/docs/component_specs/custom/common"},next:{title:"Layotto sidecar injector",permalink:"/layotto/en-US/docs/operation/sidecar_injector"}},l={},c=[{value:"1. Deploy Layotto",id:"1-deploy-layotto",level:2},{value:"Deploy Layotto using released binaries",id:"deploy-layotto-using-released-binaries",level:3},{value:"Deploy using Docker",id:"deploy-using-docker",level:3},{value:"Deploy on Kubernetes",id:"deploy-on-kubernetes",level:3},{value:"Option 1. Deploy using Istio",id:"option-1-deploy-using-istio",level:4},{value:"Option 2. Other ways",id:"option-2-other-ways",level:4},{value:"2.Toggle existing MOSN to Layotto for MOSN users",id:"2toggle-existing-mosn-to-layotto-for-mosn-users",level:2},{value:"3. How to upgrade Layotto",id:"3-how-to-upgrade-layotto",level:2}];function d(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.h1,{id:"how-to-deploy-and-upgrade-layotto",children:"How to deploy and upgrade Layotto"}),"\n",(0,n.jsx)(o.h2,{id:"1-deploy-layotto",children:"1. Deploy Layotto"}),"\n",(0,n.jsx)(o.p,{children:"There are some ways to deploy Layotto that you can find below."}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"Deploy using released binaries"}),"\n",(0,n.jsx)(o.li,{children:"Deploy using Docker"}),"\n",(0,n.jsx)(o.li,{children:"Deploy on Kubernetes"}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"deploy-layotto-using-released-binaries",children:"Deploy Layotto using released binaries"}),"\n",(0,n.jsxs)(o.p,{children:["You can start Layotto directly via executing the binary file. Refer to the ",(0,n.jsx)(o.a,{href:"start",children:"Quick start"})," guide."]}),"\n",(0,n.jsx)(o.h3,{id:"deploy-using-docker",children:"Deploy using Docker"}),"\n",(0,n.jsx)(o.p,{children:"You can run Layotto using the official Docker images.Currently include:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://hub.docker.com/repository/docker/layotto/layotto",children:"layotto/layotto"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://hub.docker.com/repository/docker/layotto/layotto.arm64",children:"layotto/layotto.arm64"})}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["It does not contain a ",(0,n.jsx)(o.code,{children:"config.json"})," configuration file in the image, you can mount your own configuration file into the ",(0,n.jsx)(o.code,{children:"/runtime/configs/"})," directory of the image. For example."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-shell",children:'docker run -v "$(pwd)/configs/config.json:/runtime/configs/config.json" -d  -p 34904:34904 --name layotto layotto/layotto start\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Of course, you can also run Layotto and other systems (such as Redis) at the same time via docker-compose. Refer to the ",(0,n.jsx)(o.a,{href:"start/state/start?id=step-1-deploy-redis-and-layotto",children:"Quick start"})]}),"\n",(0,n.jsx)(o.h3,{id:"deploy-on-kubernetes",children:"Deploy on Kubernetes"}),"\n",(0,n.jsx)(o.h4,{id:"option-1-deploy-using-istio",children:"Option 1. Deploy using Istio"}),"\n",(0,n.jsx)(o.p,{children:"If you are using Istio, you can deploy the Layotto sidecar using Istio."}),"\n",(0,n.jsx)(o.p,{children:"In order to integrate with Istio, you need to build the Layotto sidecar as a proxyv2 image. There are several ways to build:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsxs)(o.p,{children:["You can refer to ",(0,n.jsx)(o.a,{href:"https://mosn.io/docs/user-guide/start/istio/",children:"MOSN guide"}),". Just replace the MOSN image in the tutorial with a Layotto image."]}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsxs)(o.p,{children:["To make the build process easier, Layotto developed the make script. After modifying the main package as needed (in the ",(0,n.jsx)(o.code,{children:"cmd/layotto"})," directory), run the following command to package it into a proxyv2 image:"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-shell",children:"make image.proxyv2.build VERSION=latest\n"})}),"\n",(0,n.jsx)(o.p,{children:"The principle of this script is to replace the binary file in the MOSN proxyv2 image with the binary file of Layotto."}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["The community has built the ",(0,n.jsx)(o.a,{href:"https://hub.docker.com/r/layotto/proxyv2",children:"layotto/proxyv2"})," image for the [Online Lab](",(0,n.jsx)(o.a,{href:"https://killercoda.com/mosn-tutorial/course",children:"https://killercoda.com/mosn-tutorial/course"})," /layotto) to demonstrate Istio+Layotto. This image packs all Layotto components into it, resulting in a very large size. We recommend that you modify the main package according to your own needs and build the image yourself, so that the built image will be much smaller."]}),"\n"]}),"\n",(0,n.jsx)(o.h4,{id:"option-2-other-ways",children:"Option 2. Other ways"}),"\n",(0,n.jsx)(o.p,{children:"You can prepare your own image and K8s configuration file, then deploy Layotto via Kubernetes."}),"\n",(0,n.jsxs)(o.p,{children:["We are working on the official Layotto image and the solution for deploying to Kubernetes using Helm, so feel free to join us to build it. More details in ",(0,n.jsx)(o.code,{children:"<https://github.com/mosn/layotto/issues/392>"})]}),"\n",(0,n.jsx)(o.h2,{id:"2toggle-existing-mosn-to-layotto-for-mosn-users",children:"2.Toggle existing MOSN to Layotto for MOSN users"}),"\n",(0,n.jsx)(o.p,{children:"Existing MOSN can be upgraded to Layotto by replacing the MOSN sidecar image with Layotto image."}),"\n",(0,n.jsx)(o.p,{children:"Explanation:"}),"\n",(0,n.jsx)(o.p,{children:"Layotto and MOSN are running in the same process, which can be understood as:"}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsx)(o.p,{children:"Layotto == MOSN + a special grpcFilter packaged together"}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"So."}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsx)(o.p,{children:'replace MOSN with Layotto == replace MOSN with "MOSN + a special grpcFilter"'}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"There is no essential difference between Layotto and MOSN, just pay attention to the versions of them, which must correspond to each other."}),"\n",(0,n.jsx)(o.p,{children:"The previously released Layotto v0.3.0 corresponds to MOSN version v0.24.1"}),"\n",(0,n.jsx)(o.h2,{id:"3-how-to-upgrade-layotto",children:"3. How to upgrade Layotto"}),"\n",(0,n.jsx)(o.p,{children:"There are two options to upgrade."}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:"Upgrade sidecar container using K8s native solution"}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.a,{href:"https://mosn.io/en/docs/concept/smooth-upgrade/",children:"Hot upgrade: upgrade the sidecar without affecting the business"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"The advantage of hot upgrade is that it can automatically migrate persistent connections, which can be seen in detail by clicking the above document."}),"\n",(0,n.jsx)(o.p,{children:"The solutions to achieve hot upgrade are as follows:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:"Register a SIGHUP event listener with MOSN, and send a SIGHUP signal to the MOSN process to call ForkExec to generate a new MOSN process."}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:"Directly start a new MOSN process."}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.a,{href:"https://mosn.io/blog/posts/mosn-sidecarset-hotupgrade/",children:"Hot upgrade using OpenKruise"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,o,t)=>{t.d(o,{R:()=>r,x:()=>a});var n=t(6540);const i={},s=n.createContext(i);function r(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);